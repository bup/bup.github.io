<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>How bup (before 0.33.5) might create incomplete trees</title>
  <style>
html {
color: #1a1a1a;
background-color: #fdfdfd;
}
body {
margin: 0 auto;
max-width: 36em;
padding-left: 50px;
padding-right: 50px;
padding-top: 50px;
padding-bottom: 50px;
hyphens: auto;
overflow-wrap: break-word;
text-rendering: optimizeLegibility;
font-kerning: normal;
}
@media (max-width: 600px) {
body {
font-size: 0.9em;
padding: 12px;
}
h1 {
font-size: 1.8em;
}
}
@media print {
html {
background-color: white;
}
body {
background-color: transparent;
color: black;
font-size: 12pt;
}
p, h2, h3 {
orphans: 3;
widows: 3;
}
h2, h3, h4 {
page-break-after: avoid;
}
}
p {
margin: 1em 0;
}
a {
color: #1a1a1a;
}
a:visited {
color: #1a1a1a;
}
img {
max-width: 100%;
}
h1, h2, h3, h4, h5, h6 {
margin-top: 1.4em;
}
h5, h6 {
font-size: 1em;
font-style: italic;
}
h6 {
font-weight: normal;
}
ol, ul {
padding-left: 1.7em;
margin-top: 1em;
}
li > ol, li > ul {
margin-top: 0;
}
blockquote {
margin: 1em 0 1em 1.7em;
padding-left: 1em;
border-left: 2px solid #e6e6e6;
color: #606060;
}
code {
font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
font-size: 85%;
margin: 0;
hyphens: manual;
}
pre {
margin: 1em 0;
overflow: auto;
}
pre code {
padding: 0;
overflow: visible;
overflow-wrap: normal;
}
.sourceCode {
background-color: transparent;
overflow: visible;
}
hr {
background-color: #1a1a1a;
border: none;
height: 1px;
margin: 1em 0;
}
table {
margin: 1em 0;
border-collapse: collapse;
width: 100%;
overflow-x: auto;
display: block;
font-variant-numeric: lining-nums tabular-nums;
}
table caption {
margin-bottom: 0.75em;
}
tbody {
margin-top: 0.5em;
border-top: 1px solid #1a1a1a;
border-bottom: 1px solid #1a1a1a;
}
th {
border-top: 1px solid #1a1a1a;
padding: 0.25em 0.5em 0.25em 0.5em;
}
td {
padding: 0.125em 0.5em 0.25em 0.5em;
}
header {
margin-bottom: 4em;
text-align: center;
}
#TOC li {
list-style: none;
}
#TOC ul {
padding-left: 1.3em;
}
#TOC > ul {
padding-left: 0;
}
#TOC a:not(:hover) {
text-decoration: none;
}
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}

ul.task-list[class]{list-style: none;}
ul.task-list li input[type="checkbox"] {
font-size: inherit;
width: 0.8em;
margin: 0 0.8em 0.2em -1.6em;
vertical-align: middle;
}
.display.math{display: block; text-align: center; margin: 0.5rem auto;}
</style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">How bup (before 0.33.5) might create incomplete
trees</h1>
</header>
<p>Versions of bup before 0.33.5 had three issues that could cause a
repository to end up with trees that had dangling references,
i.e. missing files, parts of files, subtrees, etc. This document
describes those issues in greater detail.</p>
<h2 id="background-git-storage-model">Background: git storage model</h2>
<p>In git, we have the following structure for an individual commit with
directories and files, labeled as “name (git-type hash)”:</p>
<center>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8IS0tIEdlbmVyYXRlZCBieSBncmFwaHZpeiB2ZXJzaW9uIDIuNDIuNCAoMCkKIC0tPgo8IS0tIFRpdGxlOiBnaXQgbW9kZWwgUGFnZXM6IDEgLS0+Cjxzdmcgd2lkdGg9IjM0MnB0IiBoZWlnaHQ9IjMzMnB0Igogdmlld0JveD0iMC4wMCAwLjAwIDM0Mi4wMCAzMzIuMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgo8ZyBpZD0iZ3JhcGgwIiBjbGFzcz0iZ3JhcGgiIHRyYW5zZm9ybT0ic2NhbGUoMSAxKSByb3RhdGUoMCkgdHJhbnNsYXRlKDQgMzI4KSI+Cjx0aXRsZT5naXQgbW9kZWw8L3RpdGxlPgo8IS0tIGNvbW1pdCAtLT4KPGcgaWQ9Im5vZGUxIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5jb21taXQ8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjIzMy41LC0zMjQgOTMuNSwtMzI0IDkzLjUsLTI4OCAyMzMuNSwtMjg4IDIzMy41LC0zMjQiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMTYzLjUiIHk9Ii0zMDIuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj5jJiM0NTsxIChjb21taXQgYWUuLi4pPC90ZXh0Pgo8L2c+CjwhLS0gcm9vdCAtLT4KPGcgaWQ9Im5vZGUyIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5yb290PC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIyMTQsLTI1MiAxMTMsLTI1MiAxMTMsLTIxNiAyMTQsLTIxNiAyMTQsLTI1MiIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIxNjMuNSIgeT0iLTIzMC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi8gKHRyZWUgOTAuLi4pPC90ZXh0Pgo8L2c+CjwhLS0gY29tbWl0JiM0NTsmZ3Q7cm9vdCAtLT4KPGcgaWQ9ImVkZ2UxIiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5jb21taXQmIzQ1OyZndDtyb290PC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTE2My41LC0yODcuN0MxNjMuNSwtMjc5Ljk4IDE2My41LC0yNzAuNzEgMTYzLjUsLTI2Mi4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxNjcsLTI2Mi4xIDE2My41LC0yNTIuMSAxNjAsLTI2Mi4xIDE2NywtMjYyLjEiLz4KPC9nPgo8IS0tIGhvbWUgLS0+CjxnIGlkPSJub2RlMyIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+aG9tZTwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjMyLC0xODAgOTUsLTE4MCA5NSwtMTQ0IDIzMiwtMTQ0IDIzMiwtMTgwIi8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjE2My41IiB5PSItMTU4LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+aG9tZS8gKHRyZWUgMWYuLi4pPC90ZXh0Pgo8L2c+CjwhLS0gcm9vdCYjNDU7Jmd0O2hvbWUgLS0+CjxnIGlkPSJlZGdlMiIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+cm9vdCYjNDU7Jmd0O2hvbWU8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNMTYzLjUsLTIxNS43QzE2My41LC0yMDcuOTggMTYzLjUsLTE5OC43MSAxNjMuNSwtMTkwLjExIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE2NywtMTkwLjEgMTYzLjUsLTE4MC4xIDE2MCwtMTkwLjEgMTY3LC0xOTAuMSIvPgo8L2c+CjwhLS0gYnVwIC0tPgo8ZyBpZD0ibm9kZTQiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmJ1cDwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjI3LjUsLTEwOCA5OS41LC0xMDggOTkuNSwtNzIgMjI3LjUsLTcyIDIyNy41LC0xMDgiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMTYzLjUiIHk9Ii04Ni4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPmJ1cC8gKHRyZWUgODguLi4pPC90ZXh0Pgo8L2c+CjwhLS0gaG9tZSYjNDU7Jmd0O2J1cCAtLT4KPGcgaWQ9ImVkZ2UzIiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5ob21lJiM0NTsmZ3Q7YnVwPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTE2My41LC0xNDMuN0MxNjMuNSwtMTM1Ljk4IDE2My41LC0xMjYuNzEgMTYzLjUsLTExOC4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxNjcsLTExOC4xIDE2My41LC0xMDguMSAxNjAsLTExOC4xIDE2NywtMTE4LjEiLz4KPC9nPgo8IS0tIGJhc2hyYyAtLT4KPGcgaWQ9Im5vZGU1IiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5iYXNocmM8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE1MSwtMzYgMCwtMzYgMCwwIDE1MSwwIDE1MSwtMzYiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iNzUuNSIgeT0iLTE0LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+LmJhc2hyYyAoYmxvYiBiOS4uLik8L3RleHQ+CjwvZz4KPCEtLSBidXAmIzQ1OyZndDtiYXNocmMgLS0+CjxnIGlkPSJlZGdlNCIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+YnVwJiM0NTsmZ3Q7YmFzaHJjPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTE0MS43NSwtNzEuN0MxMzAuNjYsLTYyLjg4IDExNy4wMywtNTIuMDMgMTA1LjAxLC00Mi40NyIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxMDcuMDEsLTM5LjU5IDk3LC0zNi4xIDEwMi42NSwtNDUuMDcgMTA3LjAxLC0zOS41OSIvPgo8L2c+CjwhLS0gZ2l0Y29uZmlnIC0tPgo8ZyBpZD0ibm9kZTYiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmdpdGNvbmZpZzwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMzM0LC0zNiAxNjksLTM2IDE2OSwwIDMzNCwwIDMzNCwtMzYiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMjUxLjUiIHk9Ii0xNC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi5naXRjb25maWcgKGJsb2IgYTEuLi4pPC90ZXh0Pgo8L2c+CjwhLS0gYnVwJiM0NTsmZ3Q7Z2l0Y29uZmlnIC0tPgo8ZyBpZD0iZWRnZTUiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPmJ1cCYjNDU7Jmd0O2dpdGNvbmZpZzwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0xODUuMjUsLTcxLjdDMTk2LjM0LC02Mi44OCAyMDkuOTcsLTUyLjAzIDIyMS45OSwtNDIuNDciLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjI0LjM1LC00NS4wNyAyMzAsLTM2LjEgMjE5Ljk5LC0zOS41OSAyMjQuMzUsLTQ1LjA3Ii8+CjwvZz4KPC9nPgo8L3N2Zz4K" />
</center>
<p>bup extends this model such that large files may be split into their
own subtrees during deduplication:</p>
<center>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8IS0tIEdlbmVyYXRlZCBieSBncmFwaHZpeiB2ZXJzaW9uIDIuNDIuNCAoMCkKIC0tPgo8IS0tIFRpdGxlOiBidXAgbW9kZWwgUGFnZXM6IDEgLS0+Cjxzdmcgd2lkdGg9IjQ2NHB0IiBoZWlnaHQ9IjI2MHB0Igogdmlld0JveD0iMC4wMCAwLjAwIDQ2My41MCAyNjAuMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgo8ZyBpZD0iZ3JhcGgwIiBjbGFzcz0iZ3JhcGgiIHRyYW5zZm9ybT0ic2NhbGUoMSAxKSByb3RhdGUoMCkgdHJhbnNsYXRlKDQgMjU2KSI+Cjx0aXRsZT5idXAgbW9kZWw8L3RpdGxlPgo8IS0tIGFib3ZlIC0tPgo8ZyBpZD0ibm9kZTEiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmFib3ZlPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxMjYsLTI1MiA3MiwtMjUyIDcyLC0yMTYgMTI2LC0yMTYgMTI2LC0yNTIiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iOTkiIHk9Ii0yMzAuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4uLi48L3RleHQ+CjwvZz4KPCEtLSBidXAgLS0+CjxnIGlkPSJub2RlMiIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+YnVwPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxNjMsLTE4MCAzNSwtMTgwIDM1LC0xNDQgMTYzLC0xNDQgMTYzLC0xODAiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iOTkiIHk9Ii0xNTguMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj5idXAvICh0cmVlIDg4Li4uKTwvdGV4dD4KPC9nPgo8IS0tIGFib3ZlJiM0NTsmZ3Q7YnVwIC0tPgo8ZyBpZD0iZWRnZTEiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPmFib3ZlJiM0NTsmZ3Q7YnVwPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTk5LC0yMTUuN0M5OSwtMjA3Ljk4IDk5LC0xOTguNzEgOTksLTE5MC4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxMDIuNSwtMTkwLjEgOTksLTE4MC4xIDk1LjUsLTE5MC4xIDEwMi41LC0xOTAuMSIvPgo8L2c+CjwhLS0gYmFzaHJjIC0tPgo8ZyBpZD0ibm9kZTMiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmJhc2hyYzwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iNTQsLTEwOCAwLC0xMDggMCwtNzIgNTQsLTcyIDU0LC0xMDgiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMjciIHk9Ii04Ni4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi4uLjwvdGV4dD4KPC9nPgo8IS0tIGJ1cCYjNDU7Jmd0O2Jhc2hyYyAtLT4KPGcgaWQ9ImVkZ2UyIiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5idXAmIzQ1OyZndDtiYXNocmM8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNODEuMiwtMTQzLjdDNzIuNCwtMTM1LjE0IDYxLjYyLC0xMjQuNjYgNTIsLTExNS4zIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjU0LjIsLTExMi41NyA0NC41OSwtMTA4LjEgNDkuMzIsLTExNy41OCA1NC4yLC0xMTIuNTciLz4KPC9nPgo8IS0tIGdpdGNvbmZpZyAtLT4KPGcgaWQ9Im5vZGU0IiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5naXRjb25maWc8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjEyNiwtMTA4IDcyLC0xMDggNzIsLTcyIDEyNiwtNzIgMTI2LC0xMDgiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iOTkiIHk9Ii04Ni4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi4uLjwvdGV4dD4KPC9nPgo8IS0tIGJ1cCYjNDU7Jmd0O2dpdGNvbmZpZyAtLT4KPGcgaWQ9ImVkZ2UzIiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5idXAmIzQ1OyZndDtnaXRjb25maWc8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNOTksLTE0My43Qzk5LC0xMzUuOTggOTksLTEyNi43MSA5OSwtMTE4LjExIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjEwMi41LC0xMTguMSA5OSwtMTA4LjEgOTUuNSwtMTE4LjEgMTAyLjUsLTExOC4xIi8+CjwvZz4KPCEtLSBsYXJnZSAtLT4KPGcgaWQ9Im5vZGU1IiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5sYXJnZTwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMzI5LjUsLTEwOCAxNDQuNSwtMTA4IDE0NC41LC03MiAzMjkuNSwtNzIgMzI5LjUsLTEwOCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIyMzciIHk9Ii04Ni4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPmJ1cCYjNDU7MC4zNS50YXIgKHRyZWUgMTEuLi4pPC90ZXh0Pgo8L2c+CjwhLS0gYnVwJiM0NTsmZ3Q7bGFyZ2UgLS0+CjxnIGlkPSJlZGdlNCIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+YnVwJiM0NTsmZ3Q7bGFyZ2U8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNMTMyLjc2LC0xNDMuODhDMTUxLjIyLC0xMzQuNTEgMTc0LjI4LC0xMjIuODEgMTk0LjAyLC0xMTIuOCIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxOTUuNzgsLTExNS44MyAyMDMuMTEsLTEwOC4xOSAxOTIuNjEsLTEwOS41OSAxOTUuNzgsLTExNS44MyIvPgo8L2c+CjwhLS0gcGFydDEgLS0+CjxnIGlkPSJub2RlNiIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+cGFydDE8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE1MS41LC0zNiAyMC41LC0zNiAyMC41LDAgMTUxLjUsMCAxNTEuNSwtMzYiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iODYiIHk9Ii0xNC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPjAwMDAgKGJsb2IgMGYuLi4pPC90ZXh0Pgo8L2c+CjwhLS0gbGFyZ2UmIzQ1OyZndDtwYXJ0MSAtLT4KPGcgaWQ9ImVkZ2U1IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5sYXJnZSYjNDU7Jmd0O3BhcnQxPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTIwMC4wNiwtNzEuODhDMTc5LjUxLC02Mi4zNSAxNTMuNzUsLTUwLjQxIDEzMS45MSwtNDAuMjgiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTMzLjM2LC0zNy4xIDEyMi44MiwtMzYuMDcgMTMwLjQyLC00My40NSAxMzMuMzYsLTM3LjEiLz4KPC9nPgo8IS0tIHBhcnQyIC0tPgo8ZyBpZD0ibm9kZTciIGNsYXNzPSJub2RlIj4KPHRpdGxlPnBhcnQyPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIzMDQsLTM2IDE3MCwtMzYgMTcwLDAgMzA0LDAgMzA0LC0zNiIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIyMzciIHk9Ii0xNC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPjA4NzkgKGJsb2IgOTEuLi4pPC90ZXh0Pgo8L2c+CjwhLS0gbGFyZ2UmIzQ1OyZndDtwYXJ0MiAtLT4KPGcgaWQ9ImVkZ2U2IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5sYXJnZSYjNDU7Jmd0O3BhcnQyPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTIzNywtNzEuN0MyMzcsLTYzLjk4IDIzNywtNTQuNzEgMjM3LC00Ni4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIyNDAuNSwtNDYuMSAyMzcsLTM2LjEgMjMzLjUsLTQ2LjEgMjQwLjUsLTQ2LjEiLz4KPC9nPgo8IS0tIHBhcnQzIC0tPgo8ZyBpZD0ibm9kZTgiIGNsYXNzPSJub2RlIj4KPHRpdGxlPnBhcnQzPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSI0NTUuNSwtMzYgMzIyLjUsLTM2IDMyMi41LDAgNDU1LjUsMCA0NTUuNSwtMzYiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzg5IiB5PSItMTQuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4xYzEwIChibG9iIDYzLi4uKTwvdGV4dD4KPC9nPgo8IS0tIGxhcmdlJiM0NTsmZ3Q7cGFydDMgLS0+CjxnIGlkPSJlZGdlNyIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+bGFyZ2UmIzQ1OyZndDtwYXJ0MzwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0yNzQuMTgsLTcxLjg4QzI5NC44NywtNjIuMzUgMzIwLjgsLTUwLjQxIDM0Mi43OCwtNDAuMjgiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMzQ0LjMyLC00My40MyAzNTEuOTQsLTM2LjA3IDM0MS4zOSwtMzcuMDcgMzQ0LjMyLC00My40MyIvPgo8L2c+CjwvZz4KPC9zdmc+Cg==" />
</center>
<p>Files can also be split into multiple levels:</p>
<center>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8IS0tIEdlbmVyYXRlZCBieSBncmFwaHZpeiB2ZXJzaW9uIDIuNDIuNCAoMCkKIC0tPgo8IS0tIFRpdGxlOiBidXAgbW9kZWwgMiBQYWdlczogMSAtLT4KPHN2ZyB3aWR0aD0iMzQycHQiIGhlaWdodD0iMjYwcHQiCiB2aWV3Qm94PSIwLjAwIDAuMDAgMzQyLjAwIDI2MC4wMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CjxnIGlkPSJncmFwaDAiIGNsYXNzPSJncmFwaCIgdHJhbnNmb3JtPSJzY2FsZSgxIDEpIHJvdGF0ZSgwKSB0cmFuc2xhdGUoNCAyNTYpIj4KPHRpdGxlPmJ1cCBtb2RlbCAyPC90aXRsZT4KPCEtLSBhYm92ZSAtLT4KPGcgaWQ9Im5vZGUxIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5hYm92ZTwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTYwLjUsLTI1MiAxMDYuNSwtMjUyIDEwNi41LC0yMTYgMTYwLjUsLTIxNiAxNjAuNSwtMjUyIi8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjEzMy41IiB5PSItMjMwLjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+Li4uPC90ZXh0Pgo8L2c+CjwhLS0gbGFyZ2UgLS0+CjxnIGlkPSJub2RlMiIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+bGFyZ2U8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjIyMi41LC0xODAgNDQuNSwtMTgwIDQ0LjUsLTE0NCAyMjIuNSwtMTQ0IDIyMi41LC0xODAiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMTMzLjUiIHk9Ii0xNTguMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj5idXAmIzQ1OzAuMzUudGFyICh0cmVlIGZmLi4uKTwvdGV4dD4KPC9nPgo8IS0tIGFib3ZlJiM0NTsmZ3Q7bGFyZ2UgLS0+CjxnIGlkPSJlZGdlMSIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+YWJvdmUmIzQ1OyZndDtsYXJnZTwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0xMzMuNSwtMjE1LjdDMTMzLjUsLTIwNy45OCAxMzMuNSwtMTk4LjcxIDEzMy41LC0xOTAuMTEiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTM3LC0xOTAuMSAxMzMuNSwtMTgwLjEgMTMwLC0xOTAuMSAxMzcsLTE5MC4xIi8+CjwvZz4KPCEtLSBwYXJ0MSAtLT4KPGcgaWQ9Im5vZGUzIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5wYXJ0MTwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTI1LC0xMDggMCwtMTA4IDAsLTcyIDEyNSwtNzIgMTI1LC0xMDgiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iNjIuNSIgeT0iLTg2LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+MDAwIChibG9iIGQ5Li4uKTwvdGV4dD4KPC9nPgo8IS0tIGxhcmdlJiM0NTsmZ3Q7cGFydDEgLS0+CjxnIGlkPSJlZGdlMiIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+bGFyZ2UmIzQ1OyZndDtwYXJ0MTwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0xMTUuOTUsLTE0My43QzEwNy4yNywtMTM1LjE0IDk2LjY0LC0xMjQuNjYgODcuMTUsLTExNS4zIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9Ijg5LjQzLC0xMTIuNjMgNzkuODUsLTEwOC4xIDg0LjUxLC0xMTcuNjIgODkuNDMsLTExMi42MyIvPgo8L2c+CjwhLS0gc3ViIC0tPgo8ZyBpZD0ibm9kZTQiIGNsYXNzPSJub2RlIj4KPHRpdGxlPnN1YjwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjY2LC0xMDggMTQzLC0xMDggMTQzLC03MiAyNjYsLTcyIDI2NiwtMTA4Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjIwNC41IiB5PSItODYuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4wNDYgKHRyZWUgYTAuLi4pPC90ZXh0Pgo8L2c+CjwhLS0gbGFyZ2UmIzQ1OyZndDtzdWIgLS0+CjxnIGlkPSJlZGdlMyIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+bGFyZ2UmIzQ1OyZndDtzdWI8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNMTUxLjA1LC0xNDMuN0MxNTkuNzMsLTEzNS4xNCAxNzAuMzYsLTEyNC42NiAxNzkuODUsLTExNS4zIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE4Mi40OSwtMTE3LjYyIDE4Ny4xNSwtMTA4LjEgMTc3LjU3LC0xMTIuNjMgMTgyLjQ5LC0xMTcuNjIiLz4KPC9nPgo8IS0tIHBhcnQyIC0tPgo8ZyBpZD0ibm9kZTUiIGNsYXNzPSJub2RlIj4KPHRpdGxlPnBhcnQyPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxOTcsLTM2IDcyLC0zNiA3MiwwIDE5NywwIDE5NywtMzYiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMTM0LjUiIHk9Ii0xNC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPjAwMCAoYmxvYiAxMi4uLik8L3RleHQ+CjwvZz4KPCEtLSBzdWImIzQ1OyZndDtwYXJ0MiAtLT4KPGcgaWQ9ImVkZ2U0IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5zdWImIzQ1OyZndDtwYXJ0MjwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0xODcuMiwtNzEuN0MxNzguNjQsLTYzLjE0IDE2OC4xNiwtNTIuNjYgMTU4LjgsLTQzLjMiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTYxLjE1LC00MC43IDE1MS42LC0zNi4xIDE1Ni4yLC00NS42NSAxNjEuMTUsLTQwLjciLz4KPC9nPgo8IS0tIHBhcnQzIC0tPgo8ZyBpZD0ibm9kZTYiIGNsYXNzPSJub2RlIj4KPHRpdGxlPnBhcnQzPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIzMzQsLTM2IDIxNSwtMzYgMjE1LDAgMzM0LDAgMzM0LC0zNiIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIyNzQuNSIgeT0iLTE0LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+MWNmIChibG9iIGVlLi4uKTwvdGV4dD4KPC9nPgo8IS0tIHN1YiYjNDU7Jmd0O3BhcnQzIC0tPgo8ZyBpZD0iZWRnZTUiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnN1YiYjNDU7Jmd0O3BhcnQzPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTIyMS44LC03MS43QzIzMC4zNiwtNjMuMTQgMjQwLjg0LC01Mi42NiAyNTAuMiwtNDMuMyIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIyNTIuOCwtNDUuNjUgMjU3LjQsLTM2LjEgMjQ3Ljg1LC00MC43IDI1Mi44LC00NS42NSIvPgo8L2c+CjwvZz4KPC9zdmc+Cg==" />
</center>
<p>There are some more details, but the git model holds overall. Commits
refer to their parent commits and a single tree, and trees refer to
their children (blobs and trees) – and of course each object is
identified by its content hash.</p>
<blockquote>
<p>Note: For the sake of simplicity I’m drawing everything as trees in
this document. In reality, the bup deduplication works exactly because
it is <em>not</em> a tree, but rather a directed acyclic graph (DAG).
Multiple backup commits that record unchanged or otherwise identical
directories or files obviously point to the object(s) representing
those, shared across them.</p>
</blockquote>
<h2 id="how-bup-save-operates">How <code>bup save</code> operates</h2>
<p>When reading files and directories from the filesystem,
<code>bup save</code> will create a number of blob and tree objects,
store them into the repository if not already present, and (usually)
finally create a new commit object that points to the previous commit
object and the new root tree object.</p>
<p>Each “plain” file saved into the repository is uniquely identified by
the hash (SHA-1) of its object. As mentioned above, and unlike git, a
file might be stored as a tree.</p>
<p>After reading a file or directory, <code>bup save</code> also updates
the bup <code>index</code> (not to be confused with git packfile
indexes) entry for it with the related hash. This helps speed up the
next <code>bup save</code> run – if the file is unchanged during the
next <code>bup index</code> run, the next <code>bup save</code> can
simply check whether the object with the hash recorded in the index is
present in the repository, and doesn’t have to open/read the file or
directory again if so.</p>
<h2 id="how-bup-get-operates">How <code>bup get</code> operates</h2>
<p>Conceptually, <code>bup get</code> simply walks over the graph of a
set of objects in the source repository, checks if the object is present
in the destination repository, and if not then it copies the object
over. If it encounters a tree object that is already present in the
destination repository, it does <em>not</em> walk into that object, for
performance reasons.</p>
<h2 id="how-bup-prune-olderbup-rm-operate">How
<code>bup prune-older</code>/<code>bup rm</code> operate</h2>
<p>Again conceptually, this works by cutting pieces out of the chain of
commits, for example a <code>bup rm saves/2024-10...</code> will change
this branch:</p>
<center>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8IS0tIEdlbmVyYXRlZCBieSBncmFwaHZpeiB2ZXJzaW9uIDIuNDIuNCAoMCkKIC0tPgo8IS0tIFRpdGxlOiBiZWZvcmUgcm0gUGFnZXM6IDEgLS0+Cjxzdmcgd2lkdGg9IjQ0OHB0IiBoZWlnaHQ9IjMzMnB0Igogdmlld0JveD0iMC4wMCAwLjAwIDQ0OC4wMCAzMzIuMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgo8ZyBpZD0iZ3JhcGgwIiBjbGFzcz0iZ3JhcGgiIHRyYW5zZm9ybT0ic2NhbGUoMSAxKSByb3RhdGUoMCkgdHJhbnNsYXRlKDQgMzI4KSI+Cjx0aXRsZT5iZWZvcmUgcm08L3RpdGxlPgo8IS0tIHNhdmVzIC0tPgo8ZyBpZD0ibm9kZTEiIGNsYXNzPSJub2RlIj4KPHRpdGxlPnNhdmVzPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSI5NSwtMzI0IDM5LC0zMjQgMzksLTI4OCA5NSwtMjg4IDk1LC0zMjQiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iNjciIHk9Ii0zMDIuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj5zYXZlczwvdGV4dD4KPC9nPgo8IS0tIHNhdmUzIC0tPgo8ZyBpZD0ibm9kZTIiIGNsYXNzPSJub2RlIj4KPHRpdGxlPnNhdmUzPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxMzQsLTI1MiAwLC0yNTIgMCwtMjE2IDEzNCwtMjE2IDEzNCwtMjUyIi8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjY3IiB5PSItMjMwLjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+MjAyNCYjNDU7MTEuLi4gKGMwLi4uKTwvdGV4dD4KPC9nPgo8IS0tIHNhdmVzJiM0NTsmZ3Q7c2F2ZTMgLS0+CjxnIGlkPSJlZGdlMSIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+c2F2ZXMmIzQ1OyZndDtzYXZlMzwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS1kYXNoYXJyYXk9IjEsNSIgZD0iTTY3LC0yODcuN0M2NywtMjc5Ljk4IDY3LC0yNzAuNzEgNjcsLTI2Mi4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSI3MC41LC0yNjIuMSA2NywtMjUyLjEgNjMuNSwtMjYyLjEgNzAuNSwtMjYyLjEiLz4KPC9nPgo8IS0tIHNhdmUyIC0tPgo8ZyBpZD0ibm9kZTMiIGNsYXNzPSJub2RlIj4KPHRpdGxlPnNhdmUyPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIyODcuNSwtMjUyIDE1Mi41LC0yNTIgMTUyLjUsLTIxNiAyODcuNSwtMjE2IDI4Ny41LC0yNTIiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMjIwIiB5PSItMjMwLjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+MjAyNCYjNDU7MTAuLi4gKGIwLi4uKTwvdGV4dD4KPC9nPgo8IS0tIHNhdmUzJiM0NTsmZ3Q7c2F2ZTIgLS0+CjxnIGlkPSJlZGdlMiIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+c2F2ZTMmIzQ1OyZndDtzYXZlMjwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0xMzQuMjQsLTIzNEMxMzYuODcsLTIzNCAxMzkuNTEsLTIzNCAxNDIuMTUsLTIzNCIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxNDIuMzMsLTIzNy41IDE1Mi4zMywtMjM0IDE0Mi4zMywtMjMwLjUgMTQyLjMzLC0yMzcuNSIvPgo8L2c+CjwhLS0gcm9vdDMgLS0+CjxnIGlkPSJub2RlNSIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+cm9vdDM8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9Ijk0LC0xODAgNDAsLTE4MCA0MCwtMTQ0IDk0LC0xNDQgOTQsLTE4MCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSI2NyIgeT0iLTE1OC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi88L3RleHQ+CjwvZz4KPCEtLSBzYXZlMyYjNDU7Jmd0O3Jvb3QzIC0tPgo8ZyBpZD0iZWRnZTQiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnNhdmUzJiM0NTsmZ3Q7cm9vdDM8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNNjcsLTIxNS43QzY3LC0yMDcuOTggNjcsLTE5OC43MSA2NywtMTkwLjExIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjcwLjUsLTE5MC4xIDY3LC0xODAuMSA2My41LC0xOTAuMSA3MC41LC0xOTAuMSIvPgo8L2c+CjwhLS0gc2F2ZTEgLS0+CjxnIGlkPSJub2RlNCIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+c2F2ZTE8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjQ0MCwtMjUyIDMwNiwtMjUyIDMwNiwtMjE2IDQ0MCwtMjE2IDQ0MCwtMjUyIi8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjM3MyIgeT0iLTIzMC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPjIwMjQmIzQ1OzA5Li4uIChhMC4uLik8L3RleHQ+CjwvZz4KPCEtLSBzYXZlMiYjNDU7Jmd0O3NhdmUxIC0tPgo8ZyBpZD0iZWRnZTMiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnNhdmUyJiM0NTsmZ3Q7c2F2ZTE8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNMjg3LjU0LC0yMzRDMjkwLjMxLC0yMzQgMjkzLjA4LC0yMzQgMjk1Ljg2LC0yMzQiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjk1LjksLTIzNy41IDMwNS45LC0yMzQgMjk1LjksLTIzMC41IDI5NS45LC0yMzcuNSIvPgo8L2c+CjwhLS0gcm9vdDIgLS0+CjxnIGlkPSJub2RlNyIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+cm9vdDI8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjI0NywtMTgwIDE5MywtMTgwIDE5MywtMTQ0IDI0NywtMTQ0IDI0NywtMTgwIi8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjIyMCIgeT0iLTE1OC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi88L3RleHQ+CjwvZz4KPCEtLSBzYXZlMiYjNDU7Jmd0O3Jvb3QyIC0tPgo8ZyBpZD0iZWRnZTYiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnNhdmUyJiM0NTsmZ3Q7cm9vdDI8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNMjIwLC0yMTUuN0MyMjAsLTIwNy45OCAyMjAsLTE5OC43MSAyMjAsLTE5MC4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIyMjMuNSwtMTkwLjEgMjIwLC0xODAuMSAyMTYuNSwtMTkwLjEgMjIzLjUsLTE5MC4xIi8+CjwvZz4KPCEtLSByb290MSAtLT4KPGcgaWQ9Im5vZGUxMSIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+cm9vdDE8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjQwMCwtMTgwIDM0NiwtMTgwIDM0NiwtMTQ0IDQwMCwtMTQ0IDQwMCwtMTgwIi8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjM3MyIgeT0iLTE1OC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi88L3RleHQ+CjwvZz4KPCEtLSBzYXZlMSYjNDU7Jmd0O3Jvb3QxIC0tPgo8ZyBpZD0iZWRnZTEwIiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5zYXZlMSYjNDU7Jmd0O3Jvb3QxPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTM3MywtMjE1LjdDMzczLC0yMDcuOTggMzczLC0xOTguNzEgMzczLC0xOTAuMTEiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMzc2LjUsLTE5MC4xIDM3MywtMTgwLjEgMzY5LjUsLTE5MC4xIDM3Ni41LC0xOTAuMSIvPgo8L2c+CjwhLS0gZG90MyAtLT4KPGcgaWQ9Im5vZGU2IiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5kb3QzPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSI5NCwtMTA4IDQwLC0xMDggNDAsLTcyIDk0LC03MiA5NCwtMTA4Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjY3IiB5PSItODYuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4uLi48L3RleHQ+CjwvZz4KPCEtLSByb290MyYjNDU7Jmd0O2RvdDMgLS0+CjxnIGlkPSJlZGdlNSIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+cm9vdDMmIzQ1OyZndDtkb3QzPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTY3LC0xNDMuN0M2NywtMTM1Ljk4IDY3LC0xMjYuNzEgNjcsLTExOC4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSI3MC41LC0xMTguMSA2NywtMTA4LjEgNjMuNSwtMTE4LjEgNzAuNSwtMTE4LjEiLz4KPC9nPgo8IS0tIGV0YyAtLT4KPGcgaWQ9Im5vZGU4IiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5ldGM8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjI4MSwtMTA4IDE1OSwtMTA4IDE1OSwtNzIgMjgxLC03MiAyODEsLTEwOCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIyMjAiIHk9Ii04Ni4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPmV0Yy8gKHRyZWUgZWUuLi4pPC90ZXh0Pgo8L2c+CjwhLS0gcm9vdDImIzQ1OyZndDtldGMgLS0+CjxnIGlkPSJlZGdlNyIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+cm9vdDImIzQ1OyZndDtldGM8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNMjIwLC0xNDMuN0MyMjAsLTEzNS45OCAyMjAsLTEyNi43MSAyMjAsLTExOC4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIyMjMuNSwtMTE4LjEgMjIwLC0xMDguMSAyMTYuNSwtMTE4LjEgMjIzLjUsLTExOC4xIi8+CjwvZz4KPCEtLSBmc3RhYiAtLT4KPGcgaWQ9Im5vZGU5IiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5mc3RhYjwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjExLjUsLTM2IDgwLjUsLTM2IDgwLjUsMCAyMTEuNSwwIDIxMS41LC0zNiIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIxNDYiIHk9Ii0xNC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPmZzdGFiIChibG9iIGY5Li4uKTwvdGV4dD4KPC9nPgo8IS0tIGV0YyYjNDU7Jmd0O2ZzdGFiIC0tPgo8ZyBpZD0iZWRnZTgiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPmV0YyYjNDU7Jmd0O2ZzdGFiPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTIwMS43MSwtNzEuN0MxOTIuNTcsLTYzLjA1IDE4MS4zNiwtNTIuNDUgMTcxLjQsLTQzLjAzIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE3My43NSwtNDAuNDMgMTY0LjA4LC0zNi4xIDE2OC45NCwtNDUuNTIgMTczLjc1LC00MC40MyIvPgo8L2c+CjwhLS0gaG9zdHMgLS0+CjxnIGlkPSJub2RlMTAiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmhvc3RzPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIzNjAuNSwtMzYgMjI5LjUsLTM2IDIyOS41LDAgMzYwLjUsMCAzNjAuNSwtMzYiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMjk1IiB5PSItMTQuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj5ob3N0cyAoYmxvYiA3Ni4uLjwvdGV4dD4KPC9nPgo8IS0tIGV0YyYjNDU7Jmd0O2hvc3RzIC0tPgo8ZyBpZD0iZWRnZTkiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPmV0YyYjNDU7Jmd0O2hvc3RzPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTIzOC41NCwtNzEuN0MyNDcuOCwtNjMuMDUgMjU5LjE2LC01Mi40NSAyNjkuMjYsLTQzLjAzIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjI3MS43NSwtNDUuNDkgMjc2LjY3LC0zNi4xIDI2Ni45OCwtNDAuMzcgMjcxLjc1LC00NS40OSIvPgo8L2c+CjwhLS0gZG90MSAtLT4KPGcgaWQ9Im5vZGUxMiIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+ZG90MTwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iNDAwLC0xMDggMzQ2LC0xMDggMzQ2LC03MiA0MDAsLTcyIDQwMCwtMTA4Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjM3MyIgeT0iLTg2LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+Li4uPC90ZXh0Pgo8L2c+CjwhLS0gcm9vdDEmIzQ1OyZndDtkb3QxIC0tPgo8ZyBpZD0iZWRnZTExIiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5yb290MSYjNDU7Jmd0O2RvdDE8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNMzczLC0xNDMuN0MzNzMsLTEzNS45OCAzNzMsLTEyNi43MSAzNzMsLTExOC4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIzNzYuNSwtMTE4LjEgMzczLC0xMDguMSAzNjkuNSwtMTE4LjEgMzc2LjUsLTExOC4xIi8+CjwvZz4KPC9nPgo8L3N2Zz4K" />
</center>
<p>into this:</p>
<center>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8IS0tIEdlbmVyYXRlZCBieSBncmFwaHZpeiB2ZXJzaW9uIDIuNDIuNCAoMCkKIC0tPgo8IS0tIFRpdGxlOiBhZnRlciBybSBQYWdlczogMSAtLT4KPHN2ZyB3aWR0aD0iNjAwcHQiIGhlaWdodD0iMzMycHQiCiB2aWV3Qm94PSIwLjAwIDAuMDAgNjAwLjAwIDMzMi4wMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CjxnIGlkPSJncmFwaDAiIGNsYXNzPSJncmFwaCIgdHJhbnNmb3JtPSJzY2FsZSgxIDEpIHJvdGF0ZSgwKSB0cmFuc2xhdGUoNCAzMjgpIj4KPHRpdGxlPmFmdGVyIHJtPC90aXRsZT4KPCEtLSBzYXZlcyAtLT4KPGcgaWQ9Im5vZGUxIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5zYXZlczwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iOTUsLTMyNCAzOSwtMzI0IDM5LC0yODggOTUsLTI4OCA5NSwtMzI0Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjY3IiB5PSItMzAyLjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+c2F2ZXM8L3RleHQ+CjwvZz4KPCEtLSBzYXZlMyAtLT4KPGcgaWQ9Im5vZGUyIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5zYXZlMzwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTM0LC0yNTIgMCwtMjUyIDAsLTIxNiAxMzQsLTIxNiAxMzQsLTI1MiIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSI2NyIgeT0iLTIzMC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPjIwMjQmIzQ1OzExLi4uIChjMS4uLik8L3RleHQ+CjwvZz4KPCEtLSBzYXZlcyYjNDU7Jmd0O3NhdmUzIC0tPgo8ZyBpZD0iZWRnZTEiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnNhdmVzJiM0NTsmZ3Q7c2F2ZTM8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBzdHJva2UtZGFzaGFycmF5PSIxLDUiIGQ9Ik02NywtMjg3LjdDNjcsLTI3OS45OCA2NywtMjcwLjcxIDY3LC0yNjIuMTEiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iNzAuNSwtMjYyLjEgNjcsLTI1Mi4xIDYzLjUsLTI2Mi4xIDcwLjUsLTI2Mi4xIi8+CjwvZz4KPCEtLSBzYXZlMSAtLT4KPGcgaWQ9Im5vZGUzIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5zYXZlMTwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iNTkyLC0yNTIgNDU4LC0yNTIgNDU4LC0yMTYgNTkyLC0yMTYgNTkyLC0yNTIiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iNTI1IiB5PSItMjMwLjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+MjAyNCYjNDU7MDkuLi4gKGEwLi4uKTwvdGV4dD4KPC9nPgo8IS0tIHNhdmUzJiM0NTsmZ3Q7c2F2ZTEgLS0+CjxnIGlkPSJlZGdlMiIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+c2F2ZTMmIzQ1OyZndDtzYXZlMTwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0xMDEuMTQsLTI1Mi4xNkMxMTYuMjcsLTI1OS4yMiAxMzQuNTcsLTI2Ni40NiAxNTIsLTI3MCAyMTQuNSwtMjgyLjY5IDM3Ni40NywtMjgyLjU2IDQzOSwtMjcwIDQ1My4xNywtMjY3LjE1IDQ2Ny45MywtMjYxLjkxIDQ4MS4xMywtMjU2LjI5Ii8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjQ4Mi43MiwtMjU5LjQxIDQ5MC40NCwtMjUyLjE2IDQ3OS44OCwtMjUzLjAyIDQ4Mi43MiwtMjU5LjQxIi8+CjwvZz4KPCEtLSByb290MyAtLT4KPGcgaWQ9Im5vZGU0IiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5yb290MzwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTcwLC0xODAgMTE2LC0xODAgMTE2LC0xNDQgMTcwLC0xNDQgMTcwLC0xODAiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMTQzIiB5PSItMTU4LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+LzwvdGV4dD4KPC9nPgo8IS0tIHNhdmUzJiM0NTsmZ3Q7cm9vdDMgLS0+CjxnIGlkPSJlZGdlMyIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+c2F2ZTMmIzQ1OyZndDtyb290MzwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik04NS43OSwtMjE1LjdDOTUuMTcsLTIwNy4wNSAxMDYuNjgsLTE5Ni40NSAxMTYuOTEsLTE4Ny4wMyIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxMTkuNDUsLTE4OS40NSAxMjQuNDMsLTE4MC4xIDExNC43LC0xODQuMyAxMTkuNDUsLTE4OS40NSIvPgo8L2c+CjwhLS0gcm9vdDEgLS0+CjxnIGlkPSJub2RlNiIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+cm9vdDE8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjU1MiwtMTgwIDQ5OCwtMTgwIDQ5OCwtMTQ0IDU1MiwtMTQ0IDU1MiwtMTgwIi8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjUyNSIgeT0iLTE1OC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi88L3RleHQ+CjwvZz4KPCEtLSBzYXZlMSYjNDU7Jmd0O3Jvb3QxIC0tPgo8ZyBpZD0iZWRnZTUiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnNhdmUxJiM0NTsmZ3Q7cm9vdDE8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNNTI1LC0yMTUuN0M1MjUsLTIwNy45OCA1MjUsLTE5OC43MSA1MjUsLTE5MC4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSI1MjguNSwtMTkwLjEgNTI1LC0xODAuMSA1MjEuNSwtMTkwLjEgNTI4LjUsLTE5MC4xIi8+CjwvZz4KPCEtLSBkb3QzIC0tPgo8ZyBpZD0ibm9kZTUiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmRvdDM8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE3MCwtMTA4IDExNiwtMTA4IDExNiwtNzIgMTcwLC03MiAxNzAsLTEwOCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIxNDMiIHk9Ii04Ni4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi4uLjwvdGV4dD4KPC9nPgo8IS0tIHJvb3QzJiM0NTsmZ3Q7ZG90MyAtLT4KPGcgaWQ9ImVkZ2U0IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5yb290MyYjNDU7Jmd0O2RvdDM8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNMTQzLC0xNDMuN0MxNDMsLTEzNS45OCAxNDMsLTEyNi43MSAxNDMsLTExOC4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxNDYuNSwtMTE4LjEgMTQzLC0xMDguMSAxMzkuNSwtMTE4LjEgMTQ2LjUsLTExOC4xIi8+CjwvZz4KPCEtLSBkb3QxIC0tPgo8ZyBpZD0ibm9kZTciIGNsYXNzPSJub2RlIj4KPHRpdGxlPmRvdDE8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjU1MiwtMTA4IDQ5OCwtMTA4IDQ5OCwtNzIgNTUyLC03MiA1NTIsLTEwOCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSI1MjUiIHk9Ii04Ni4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi4uLjwvdGV4dD4KPC9nPgo8IS0tIHJvb3QxJiM0NTsmZ3Q7ZG90MSAtLT4KPGcgaWQ9ImVkZ2U2IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5yb290MSYjNDU7Jmd0O2RvdDE8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNNTI1LC0xNDMuN0M1MjUsLTEzNS45OCA1MjUsLTEyNi43MSA1MjUsLTExOC4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSI1MjguNSwtMTE4LjEgNTI1LC0xMDguMSA1MjEuNSwtMTE4LjEgNTI4LjUsLTExOC4xIi8+CjwvZz4KPCEtLSBzYXZlM29yaWcgLS0+CjxnIGlkPSJub2RlOCIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+c2F2ZTNvcmlnPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLWRhc2hhcnJheT0iMSw1IiBwb2ludHM9IjI4NiwtMjUyIDE1MiwtMjUyIDE1MiwtMjE2IDI4NiwtMjE2IDI4NiwtMjUyIi8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjIxOSIgeT0iLTIzMC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPjIwMjQmIzQ1OzExLi4uIChjMC4uLik8L3RleHQ+CjwvZz4KPCEtLSBzYXZlM29yaWcmIzQ1OyZndDtyb290MyAtLT4KPGcgaWQ9ImVkZ2U5IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5zYXZlM29yaWcmIzQ1OyZndDtyb290MzwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0yMDAuMjEsLTIxNS43QzE5MC44MywtMjA3LjA1IDE3OS4zMiwtMTk2LjQ1IDE2OS4wOSwtMTg3LjAzIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE3MS4zLC0xODQuMyAxNjEuNTcsLTE4MC4xIDE2Ni41NSwtMTg5LjQ1IDE3MS4zLC0xODQuMyIvPgo8L2c+CjwhLS0gc2F2ZTIgLS0+CjxnIGlkPSJub2RlOSIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+c2F2ZTI8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBzdHJva2UtZGFzaGFycmF5PSIxLDUiIHBvaW50cz0iNDM5LjUsLTI1MiAzMDQuNSwtMjUyIDMwNC41LC0yMTYgNDM5LjUsLTIxNiA0MzkuNSwtMjUyIi8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjM3MiIgeT0iLTIzMC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPjIwMjQmIzQ1OzEwLi4uIChiMC4uLik8L3RleHQ+CjwvZz4KPCEtLSBzYXZlM29yaWcmIzQ1OyZndDtzYXZlMiAtLT4KPGcgaWQ9ImVkZ2U3IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5zYXZlM29yaWcmIzQ1OyZndDtzYXZlMjwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0yODYuMjQsLTIzNEMyODguODcsLTIzNCAyOTEuNTEsLTIzNCAyOTQuMTUsLTIzNCIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIyOTQuMzMsLTIzNy41IDMwNC4zMywtMjM0IDI5NC4zMywtMjMwLjUgMjk0LjMzLC0yMzcuNSIvPgo8L2c+CjwhLS0gc2F2ZTImIzQ1OyZndDtzYXZlMSAtLT4KPGcgaWQ9ImVkZ2U4IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5zYXZlMiYjNDU7Jmd0O3NhdmUxPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTQzOS41NCwtMjM0QzQ0Mi4zMSwtMjM0IDQ0NS4wOCwtMjM0IDQ0Ny44NiwtMjM0Ii8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjQ0Ny45LC0yMzcuNSA0NTcuOSwtMjM0IDQ0Ny45LC0yMzAuNSA0NDcuOSwtMjM3LjUiLz4KPC9nPgo8IS0tIHJvb3QyIC0tPgo8ZyBpZD0ibm9kZTEwIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5yb290MjwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS1kYXNoYXJyYXk9IjEsNSIgcG9pbnRzPSIzOTksLTE4MCAzNDUsLTE4MCAzNDUsLTE0NCAzOTksLTE0NCAzOTksLTE4MCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIzNzIiIHk9Ii0xNTguMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4vPC90ZXh0Pgo8L2c+CjwhLS0gc2F2ZTImIzQ1OyZndDtyb290MiAtLT4KPGcgaWQ9ImVkZ2UxMCIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+c2F2ZTImIzQ1OyZndDtyb290MjwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0zNzIsLTIxNS43QzM3MiwtMjA3Ljk4IDM3MiwtMTk4LjcxIDM3MiwtMTkwLjExIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjM3NS41LC0xOTAuMSAzNzIsLTE4MC4xIDM2OC41LC0xOTAuMSAzNzUuNSwtMTkwLjEiLz4KPC9nPgo8IS0tIGV0YyAtLT4KPGcgaWQ9Im5vZGUxMSIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+ZXRjPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLWRhc2hhcnJheT0iMSw1IiBwb2ludHM9IjQzMywtMTA4IDMxMSwtMTA4IDMxMSwtNzIgNDMzLC03MiA0MzMsLTEwOCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIzNzIiIHk9Ii04Ni4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPmV0Yy8gKHRyZWUgZWUuLi4pPC90ZXh0Pgo8L2c+CjwhLS0gcm9vdDImIzQ1OyZndDtldGMgLS0+CjxnIGlkPSJlZGdlMTEiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnJvb3QyJiM0NTsmZ3Q7ZXRjPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTM3MiwtMTQzLjdDMzcyLC0xMzUuOTggMzcyLC0xMjYuNzEgMzcyLC0xMTguMTEiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMzc1LjUsLTExOC4xIDM3MiwtMTA4LjEgMzY4LjUsLTExOC4xIDM3NS41LC0xMTguMSIvPgo8L2c+CjwhLS0gZnN0YWIgLS0+CjxnIGlkPSJub2RlMTIiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmZzdGFiPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLWRhc2hhcnJheT0iMSw1IiBwb2ludHM9IjM2MS41LC0zNiAyMzAuNSwtMzYgMjMwLjUsMCAzNjEuNSwwIDM2MS41LC0zNiIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIyOTYiIHk9Ii0xNC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPmZzdGFiIChibG9iIGY5Li4uKTwvdGV4dD4KPC9nPgo8IS0tIGV0YyYjNDU7Jmd0O2ZzdGFiIC0tPgo8ZyBpZD0iZWRnZTEyIiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5ldGMmIzQ1OyZndDtmc3RhYjwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0zNTMuMjEsLTcxLjdDMzQzLjgzLC02My4wNSAzMzIuMzIsLTUyLjQ1IDMyMi4wOSwtNDMuMDMiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMzI0LjMsLTQwLjMgMzE0LjU3LC0zNi4xIDMxOS41NSwtNDUuNDUgMzI0LjMsLTQwLjMiLz4KPC9nPgo8IS0tIGhvc3RzIC0tPgo8ZyBpZD0ibm9kZTEzIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5ob3N0czwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS1kYXNoYXJyYXk9IjEsNSIgcG9pbnRzPSI1MTYuNSwtMzYgMzc5LjUsLTM2IDM3OS41LDAgNTE2LjUsMCA1MTYuNSwtMzYiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iNDQ4IiB5PSItMTQuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj5ob3N0cyAoYmxvYiA3Ni4uLik8L3RleHQ+CjwvZz4KPCEtLSBldGMmIzQ1OyZndDtob3N0cyAtLT4KPGcgaWQ9ImVkZ2UxMyIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+ZXRjJiM0NTsmZ3Q7aG9zdHM8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNMzkwLjc5LC03MS43QzQwMC4xNywtNjMuMDUgNDExLjY4LC01Mi40NSA0MjEuOTEsLTQzLjAzIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjQyNC40NSwtNDUuNDUgNDI5LjQzLC0zNi4xIDQxOS43LC00MC4zIDQyNC40NSwtNDUuNDUiLz4KPC9nPgo8L2c+Cjwvc3ZnPgo=" />
</center>
<p>As you can see, the save (commit) <code>2024-10...</code> object and
the trees/blobs it points to still exist in the repository, though
they’re detached from <code>saves</code>.</p>
<h2 id="how-bup-gc-operates">How <code>bup gc</code> operates</h2>
<p>GC is intended to clean up those dangling objects. So after the prune
example above, ideally we want to have in the repository only this left
after GC:</p>
<center>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8IS0tIEdlbmVyYXRlZCBieSBncmFwaHZpeiB2ZXJzaW9uIDIuNDIuNCAoMCkKIC0tPgo8IS0tIFRpdGxlOiBhZnRlciBybSBhbmQgZ2MgUGFnZXM6IDEgLS0+Cjxzdmcgd2lkdGg9IjI5NHB0IiBoZWlnaHQ9IjI2MHB0Igogdmlld0JveD0iMC4wMCAwLjAwIDI5NC4wMCAyNjAuMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgo8ZyBpZD0iZ3JhcGgwIiBjbGFzcz0iZ3JhcGgiIHRyYW5zZm9ybT0ic2NhbGUoMSAxKSByb3RhdGUoMCkgdHJhbnNsYXRlKDQgMjU2KSI+Cjx0aXRsZT5hZnRlciBybSBhbmQgZ2M8L3RpdGxlPgo8IS0tIHNhdmVzIC0tPgo8ZyBpZD0ibm9kZTEiIGNsYXNzPSJub2RlIj4KPHRpdGxlPnNhdmVzPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSI5NSwtMjUyIDM5LC0yNTIgMzksLTIxNiA5NSwtMjE2IDk1LC0yNTIiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iNjciIHk9Ii0yMzAuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj5zYXZlczwvdGV4dD4KPC9nPgo8IS0tIHNhdmUzIC0tPgo8ZyBpZD0ibm9kZTIiIGNsYXNzPSJub2RlIj4KPHRpdGxlPnNhdmUzPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxMzQsLTE4MCAwLC0xODAgMCwtMTQ0IDEzNCwtMTQ0IDEzNCwtMTgwIi8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjY3IiB5PSItMTU4LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+MjAyNCYjNDU7MTEuLi4gKGMxLi4uKTwvdGV4dD4KPC9nPgo8IS0tIHNhdmVzJiM0NTsmZ3Q7c2F2ZTMgLS0+CjxnIGlkPSJlZGdlMSIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+c2F2ZXMmIzQ1OyZndDtzYXZlMzwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS1kYXNoYXJyYXk9IjEsNSIgZD0iTTY3LC0yMTUuN0M2NywtMjA3Ljk4IDY3LC0xOTguNzEgNjcsLTE5MC4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSI3MC41LC0xOTAuMSA2NywtMTgwLjEgNjMuNSwtMTkwLjEgNzAuNSwtMTkwLjEiLz4KPC9nPgo8IS0tIHNhdmUxIC0tPgo8ZyBpZD0ibm9kZTMiIGNsYXNzPSJub2RlIj4KPHRpdGxlPnNhdmUxPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIyODYsLTE4MCAxNTIsLTE4MCAxNTIsLTE0NCAyODYsLTE0NCAyODYsLTE4MCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIyMTkiIHk9Ii0xNTguMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4yMDI0JiM0NTswOS4uLiAoYTAuLi4pPC90ZXh0Pgo8L2c+CjwhLS0gc2F2ZTMmIzQ1OyZndDtzYXZlMSAtLT4KPGcgaWQ9ImVkZ2UyIiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5zYXZlMyYjNDU7Jmd0O3NhdmUxPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTEzNC4wOSwtMTYyQzEzNi41NywtMTYyIDEzOS4wNCwtMTYyIDE0MS41MSwtMTYyIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE0MS42NywtMTY1LjUgMTUxLjY3LC0xNjIgMTQxLjY3LC0xNTguNSAxNDEuNjcsLTE2NS41Ii8+CjwvZz4KPCEtLSByb290MyAtLT4KPGcgaWQ9Im5vZGU0IiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5yb290MzwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iOTQsLTEwOCA0MCwtMTA4IDQwLC03MiA5NCwtNzIgOTQsLTEwOCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSI2NyIgeT0iLTg2LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+LzwvdGV4dD4KPC9nPgo8IS0tIHNhdmUzJiM0NTsmZ3Q7cm9vdDMgLS0+CjxnIGlkPSJlZGdlMyIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+c2F2ZTMmIzQ1OyZndDtyb290MzwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik02NywtMTQzLjdDNjcsLTEzNS45OCA2NywtMTI2LjcxIDY3LC0xMTguMTEiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iNzAuNSwtMTE4LjEgNjcsLTEwOC4xIDYzLjUsLTExOC4xIDcwLjUsLTExOC4xIi8+CjwvZz4KPCEtLSByb290MSAtLT4KPGcgaWQ9Im5vZGU2IiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5yb290MTwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjQ2LC0xMDggMTkyLC0xMDggMTkyLC03MiAyNDYsLTcyIDI0NiwtMTA4Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjIxOSIgeT0iLTg2LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+LzwvdGV4dD4KPC9nPgo8IS0tIHNhdmUxJiM0NTsmZ3Q7cm9vdDEgLS0+CjxnIGlkPSJlZGdlNSIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+c2F2ZTEmIzQ1OyZndDtyb290MTwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0yMTksLTE0My43QzIxOSwtMTM1Ljk4IDIxOSwtMTI2LjcxIDIxOSwtMTE4LjExIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjIyMi41LC0xMTguMSAyMTksLTEwOC4xIDIxNS41LC0xMTguMSAyMjIuNSwtMTE4LjEiLz4KPC9nPgo8IS0tIGRvdDMgLS0+CjxnIGlkPSJub2RlNSIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+ZG90MzwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iOTQsLTM2IDQwLC0zNiA0MCwwIDk0LDAgOTQsLTM2Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjY3IiB5PSItMTQuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4uLi48L3RleHQ+CjwvZz4KPCEtLSByb290MyYjNDU7Jmd0O2RvdDMgLS0+CjxnIGlkPSJlZGdlNCIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+cm9vdDMmIzQ1OyZndDtkb3QzPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTY3LC03MS43QzY3LC02My45OCA2NywtNTQuNzEgNjcsLTQ2LjExIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjcwLjUsLTQ2LjEgNjcsLTM2LjEgNjMuNSwtNDYuMSA3MC41LC00Ni4xIi8+CjwvZz4KPCEtLSBkb3QxIC0tPgo8ZyBpZD0ibm9kZTciIGNsYXNzPSJub2RlIj4KPHRpdGxlPmRvdDE8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjI0NiwtMzYgMTkyLC0zNiAxOTIsMCAyNDYsMCAyNDYsLTM2Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjIxOSIgeT0iLTE0LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+Li4uPC90ZXh0Pgo8L2c+CjwhLS0gcm9vdDEmIzQ1OyZndDtkb3QxIC0tPgo8ZyBpZD0iZWRnZTYiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnJvb3QxJiM0NTsmZ3Q7ZG90MTwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0yMTksLTcxLjdDMjE5LC02My45OCAyMTksLTU0LjcxIDIxOSwtNDYuMTEiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjIyLjUsLTQ2LjEgMjE5LC0zNi4xIDIxNS41LC00Ni4xIDIyMi41LC00Ni4xIi8+CjwvZz4KPC9nPgo8L3N2Zz4K" />
</center>
<p>This is not exactly what happens, unfortunately. We’re still doing
some background, so more on this later.</p>
<h2 id="object-existence-checking">Object existence checking</h2>
<p>In order to check if objects already exist in the repository, bup
uses three different data structures:</p>
<h3 id="idx-files"><code>*.idx</code> files</h3>
<p>For each pack file, git and bup use an idx file that contains a list
of all the objects in the pack file, and also points to the object
inside the pack, so you can retrieve a desired object. Checking for
existence just requires seeing if the object name is in the list.</p>
<p>These files can be recreated from the pack files, but this is
expensive.</p>
<h3 id="midx-files"><code>*.midx</code> files</h3>
<p>The midx files have a similar structure, except they cover multiple
pack files and tell you which pack file an object is located in (but not
where in that pack file).</p>
<p>These files are created from the <code>*.idx</code> files and are
ephemeral, they can be destroyed and recreated at will.</p>
<h3 id="bloom-filter">Bloom filter</h3>
<p>To see if it’s even worth checking, bup uses a <a href="https://en.wikipedia.org/wiki/Bloom_filter">Bloom filter</a>
(<code>bup.bloom</code>), which is a probabilistic data structure that
can say “I’ve never heard about this object before” and “I might have
seen this object before”. If it says the object doesn’t exist, there’s
no need to check the midx/idx files. If it says the object
<em>might</em> exist, then those files need to be consulted. The Bloom
filter is therefore not relevant to the issues at hand.</p>
<p>Just like the <code>*.midx</code> files, this file is created from
the <code>*.idx</code> files (or perhaps from the <code>*.midx</code>
that in turn come from <code>*.idx</code>) and is also ephemeral, so it
can be destroyed and recreated at will.</p>
<h2 id="remote-save---bup-save--r">Remote save -
<code>bup save -r</code></h2>
<p>In order to avoid transferring a lot of data that might not be
needed, bup clients synchronize the idx files with the idx files on the
server when connecting. They then rebuild midx/bloom files, and then the
save can do a local “does this object exist already” check, rather than
either shipping the object to the server for it to check, or asking the
server to check, both of which would take a lot of time (due to
bandwidth and latency respectively.)</p>
<h2 id="bug-1-remotely-cached-midx-files">Bug #1 (remotely cached midx
files)</h2>
<p>When GC is done on a repository, of course some pack files will be
removed along with their idx files.</p>
<p>When a client synchronizes the idx files, it deletes the idx files
from the cache that were removed on the server repository, so that
testing for objects that were previously contained in them should no
longer indicate that they already exist.</p>
<p>However, the midx files are incorrectly updated. Remember that midx
files are created from the idx files. When updating the midx files after
the idx synchronization, bup doesn’t check whether or not any of the
midx file(s) still contain(s) content from a now-deleted idx file. This
can lead to checking for object existence and being given the answer
that an object exists, even though it was GC’ed in the repository, and
in fact the idx files no longer show that it exists, only the incorrect
midx does.</p>
<p>This in turn can lead to <code>save -r</code> or <code>get -r</code>
omitting an object that had previously existed, but has been removed by
GC on the remote (omitted because the midx still thinks the remote has
it).</p>
<p>This doesn’t happen with local use of the repository (without
<code>-r</code> or <code>bup on</code>) since gc removes all midx/bloom
files.</p>
<p>Since version 0.33.5, <code>bup</code> regenerates the midx files
correctly.</p>
<h2 id="bug-2">Bug #2</h2>
<p>I previously showed that after prune, you have this set of objects in
the repository:</p>
<center>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8IS0tIEdlbmVyYXRlZCBieSBncmFwaHZpeiB2ZXJzaW9uIDIuNDIuNCAoMCkKIC0tPgo8IS0tIFRpdGxlOiBhZnRlciBybSBQYWdlczogMSAtLT4KPHN2ZyB3aWR0aD0iNjAwcHQiIGhlaWdodD0iMzMycHQiCiB2aWV3Qm94PSIwLjAwIDAuMDAgNjAwLjAwIDMzMi4wMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CjxnIGlkPSJncmFwaDAiIGNsYXNzPSJncmFwaCIgdHJhbnNmb3JtPSJzY2FsZSgxIDEpIHJvdGF0ZSgwKSB0cmFuc2xhdGUoNCAzMjgpIj4KPHRpdGxlPmFmdGVyIHJtPC90aXRsZT4KPCEtLSBzYXZlcyAtLT4KPGcgaWQ9Im5vZGUxIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5zYXZlczwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iOTUsLTMyNCAzOSwtMzI0IDM5LC0yODggOTUsLTI4OCA5NSwtMzI0Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjY3IiB5PSItMzAyLjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+c2F2ZXM8L3RleHQ+CjwvZz4KPCEtLSBzYXZlMyAtLT4KPGcgaWQ9Im5vZGUyIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5zYXZlMzwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTM0LC0yNTIgMCwtMjUyIDAsLTIxNiAxMzQsLTIxNiAxMzQsLTI1MiIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSI2NyIgeT0iLTIzMC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPjIwMjQmIzQ1OzExLi4uIChjMS4uLik8L3RleHQ+CjwvZz4KPCEtLSBzYXZlcyYjNDU7Jmd0O3NhdmUzIC0tPgo8ZyBpZD0iZWRnZTEiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnNhdmVzJiM0NTsmZ3Q7c2F2ZTM8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBzdHJva2UtZGFzaGFycmF5PSIxLDUiIGQ9Ik02NywtMjg3LjdDNjcsLTI3OS45OCA2NywtMjcwLjcxIDY3LC0yNjIuMTEiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iNzAuNSwtMjYyLjEgNjcsLTI1Mi4xIDYzLjUsLTI2Mi4xIDcwLjUsLTI2Mi4xIi8+CjwvZz4KPCEtLSBzYXZlMSAtLT4KPGcgaWQ9Im5vZGUzIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5zYXZlMTwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iNTkyLC0yNTIgNDU4LC0yNTIgNDU4LC0yMTYgNTkyLC0yMTYgNTkyLC0yNTIiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iNTI1IiB5PSItMjMwLjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+MjAyNCYjNDU7MDkuLi4gKGEwLi4uKTwvdGV4dD4KPC9nPgo8IS0tIHNhdmUzJiM0NTsmZ3Q7c2F2ZTEgLS0+CjxnIGlkPSJlZGdlMiIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+c2F2ZTMmIzQ1OyZndDtzYXZlMTwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0xMDEuMTQsLTI1Mi4xNkMxMTYuMjcsLTI1OS4yMiAxMzQuNTcsLTI2Ni40NiAxNTIsLTI3MCAyMTQuNSwtMjgyLjY5IDM3Ni40NywtMjgyLjU2IDQzOSwtMjcwIDQ1My4xNywtMjY3LjE1IDQ2Ny45MywtMjYxLjkxIDQ4MS4xMywtMjU2LjI5Ii8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjQ4Mi43MiwtMjU5LjQxIDQ5MC40NCwtMjUyLjE2IDQ3OS44OCwtMjUzLjAyIDQ4Mi43MiwtMjU5LjQxIi8+CjwvZz4KPCEtLSByb290MyAtLT4KPGcgaWQ9Im5vZGU0IiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5yb290MzwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTcwLC0xODAgMTE2LC0xODAgMTE2LC0xNDQgMTcwLC0xNDQgMTcwLC0xODAiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMTQzIiB5PSItMTU4LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+LzwvdGV4dD4KPC9nPgo8IS0tIHNhdmUzJiM0NTsmZ3Q7cm9vdDMgLS0+CjxnIGlkPSJlZGdlMyIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+c2F2ZTMmIzQ1OyZndDtyb290MzwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik04NS43OSwtMjE1LjdDOTUuMTcsLTIwNy4wNSAxMDYuNjgsLTE5Ni40NSAxMTYuOTEsLTE4Ny4wMyIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxMTkuNDUsLTE4OS40NSAxMjQuNDMsLTE4MC4xIDExNC43LC0xODQuMyAxMTkuNDUsLTE4OS40NSIvPgo8L2c+CjwhLS0gcm9vdDEgLS0+CjxnIGlkPSJub2RlNiIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+cm9vdDE8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjU1MiwtMTgwIDQ5OCwtMTgwIDQ5OCwtMTQ0IDU1MiwtMTQ0IDU1MiwtMTgwIi8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjUyNSIgeT0iLTE1OC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi88L3RleHQ+CjwvZz4KPCEtLSBzYXZlMSYjNDU7Jmd0O3Jvb3QxIC0tPgo8ZyBpZD0iZWRnZTUiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnNhdmUxJiM0NTsmZ3Q7cm9vdDE8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNNTI1LC0yMTUuN0M1MjUsLTIwNy45OCA1MjUsLTE5OC43MSA1MjUsLTE5MC4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSI1MjguNSwtMTkwLjEgNTI1LC0xODAuMSA1MjEuNSwtMTkwLjEgNTI4LjUsLTE5MC4xIi8+CjwvZz4KPCEtLSBkb3QzIC0tPgo8ZyBpZD0ibm9kZTUiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmRvdDM8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE3MCwtMTA4IDExNiwtMTA4IDExNiwtNzIgMTcwLC03MiAxNzAsLTEwOCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIxNDMiIHk9Ii04Ni4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi4uLjwvdGV4dD4KPC9nPgo8IS0tIHJvb3QzJiM0NTsmZ3Q7ZG90MyAtLT4KPGcgaWQ9ImVkZ2U0IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5yb290MyYjNDU7Jmd0O2RvdDM8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNMTQzLC0xNDMuN0MxNDMsLTEzNS45OCAxNDMsLTEyNi43MSAxNDMsLTExOC4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxNDYuNSwtMTE4LjEgMTQzLC0xMDguMSAxMzkuNSwtMTE4LjEgMTQ2LjUsLTExOC4xIi8+CjwvZz4KPCEtLSBkb3QxIC0tPgo8ZyBpZD0ibm9kZTciIGNsYXNzPSJub2RlIj4KPHRpdGxlPmRvdDE8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjU1MiwtMTA4IDQ5OCwtMTA4IDQ5OCwtNzIgNTUyLC03MiA1NTIsLTEwOCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSI1MjUiIHk9Ii04Ni4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi4uLjwvdGV4dD4KPC9nPgo8IS0tIHJvb3QxJiM0NTsmZ3Q7ZG90MSAtLT4KPGcgaWQ9ImVkZ2U2IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5yb290MSYjNDU7Jmd0O2RvdDE8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNNTI1LC0xNDMuN0M1MjUsLTEzNS45OCA1MjUsLTEyNi43MSA1MjUsLTExOC4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSI1MjguNSwtMTE4LjEgNTI1LC0xMDguMSA1MjEuNSwtMTE4LjEgNTI4LjUsLTExOC4xIi8+CjwvZz4KPCEtLSBzYXZlM29yaWcgLS0+CjxnIGlkPSJub2RlOCIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+c2F2ZTNvcmlnPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLWRhc2hhcnJheT0iMSw1IiBwb2ludHM9IjI4NiwtMjUyIDE1MiwtMjUyIDE1MiwtMjE2IDI4NiwtMjE2IDI4NiwtMjUyIi8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjIxOSIgeT0iLTIzMC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPjIwMjQmIzQ1OzExLi4uIChjMC4uLik8L3RleHQ+CjwvZz4KPCEtLSBzYXZlM29yaWcmIzQ1OyZndDtyb290MyAtLT4KPGcgaWQ9ImVkZ2U5IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5zYXZlM29yaWcmIzQ1OyZndDtyb290MzwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0yMDAuMjEsLTIxNS43QzE5MC44MywtMjA3LjA1IDE3OS4zMiwtMTk2LjQ1IDE2OS4wOSwtMTg3LjAzIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE3MS4zLC0xODQuMyAxNjEuNTcsLTE4MC4xIDE2Ni41NSwtMTg5LjQ1IDE3MS4zLC0xODQuMyIvPgo8L2c+CjwhLS0gc2F2ZTIgLS0+CjxnIGlkPSJub2RlOSIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+c2F2ZTI8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBzdHJva2UtZGFzaGFycmF5PSIxLDUiIHBvaW50cz0iNDM5LjUsLTI1MiAzMDQuNSwtMjUyIDMwNC41LC0yMTYgNDM5LjUsLTIxNiA0MzkuNSwtMjUyIi8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjM3MiIgeT0iLTIzMC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPjIwMjQmIzQ1OzEwLi4uIChiMC4uLik8L3RleHQ+CjwvZz4KPCEtLSBzYXZlM29yaWcmIzQ1OyZndDtzYXZlMiAtLT4KPGcgaWQ9ImVkZ2U3IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5zYXZlM29yaWcmIzQ1OyZndDtzYXZlMjwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0yODYuMjQsLTIzNEMyODguODcsLTIzNCAyOTEuNTEsLTIzNCAyOTQuMTUsLTIzNCIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIyOTQuMzMsLTIzNy41IDMwNC4zMywtMjM0IDI5NC4zMywtMjMwLjUgMjk0LjMzLC0yMzcuNSIvPgo8L2c+CjwhLS0gc2F2ZTImIzQ1OyZndDtzYXZlMSAtLT4KPGcgaWQ9ImVkZ2U4IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5zYXZlMiYjNDU7Jmd0O3NhdmUxPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTQzOS41NCwtMjM0QzQ0Mi4zMSwtMjM0IDQ0NS4wOCwtMjM0IDQ0Ny44NiwtMjM0Ii8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjQ0Ny45LC0yMzcuNSA0NTcuOSwtMjM0IDQ0Ny45LC0yMzAuNSA0NDcuOSwtMjM3LjUiLz4KPC9nPgo8IS0tIHJvb3QyIC0tPgo8ZyBpZD0ibm9kZTEwIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5yb290MjwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS1kYXNoYXJyYXk9IjEsNSIgcG9pbnRzPSIzOTksLTE4MCAzNDUsLTE4MCAzNDUsLTE0NCAzOTksLTE0NCAzOTksLTE4MCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIzNzIiIHk9Ii0xNTguMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4vPC90ZXh0Pgo8L2c+CjwhLS0gc2F2ZTImIzQ1OyZndDtyb290MiAtLT4KPGcgaWQ9ImVkZ2UxMCIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+c2F2ZTImIzQ1OyZndDtyb290MjwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0zNzIsLTIxNS43QzM3MiwtMjA3Ljk4IDM3MiwtMTk4LjcxIDM3MiwtMTkwLjExIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjM3NS41LC0xOTAuMSAzNzIsLTE4MC4xIDM2OC41LC0xOTAuMSAzNzUuNSwtMTkwLjEiLz4KPC9nPgo8IS0tIGV0YyAtLT4KPGcgaWQ9Im5vZGUxMSIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+ZXRjPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLWRhc2hhcnJheT0iMSw1IiBwb2ludHM9IjQzMywtMTA4IDMxMSwtMTA4IDMxMSwtNzIgNDMzLC03MiA0MzMsLTEwOCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIzNzIiIHk9Ii04Ni4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPmV0Yy8gKHRyZWUgZWUuLi4pPC90ZXh0Pgo8L2c+CjwhLS0gcm9vdDImIzQ1OyZndDtldGMgLS0+CjxnIGlkPSJlZGdlMTEiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnJvb3QyJiM0NTsmZ3Q7ZXRjPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTM3MiwtMTQzLjdDMzcyLC0xMzUuOTggMzcyLC0xMjYuNzEgMzcyLC0xMTguMTEiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMzc1LjUsLTExOC4xIDM3MiwtMTA4LjEgMzY4LjUsLTExOC4xIDM3NS41LC0xMTguMSIvPgo8L2c+CjwhLS0gZnN0YWIgLS0+CjxnIGlkPSJub2RlMTIiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmZzdGFiPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLWRhc2hhcnJheT0iMSw1IiBwb2ludHM9IjM2MS41LC0zNiAyMzAuNSwtMzYgMjMwLjUsMCAzNjEuNSwwIDM2MS41LC0zNiIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIyOTYiIHk9Ii0xNC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPmZzdGFiIChibG9iIGY5Li4uKTwvdGV4dD4KPC9nPgo8IS0tIGV0YyYjNDU7Jmd0O2ZzdGFiIC0tPgo8ZyBpZD0iZWRnZTEyIiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5ldGMmIzQ1OyZndDtmc3RhYjwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0zNTMuMjEsLTcxLjdDMzQzLjgzLC02My4wNSAzMzIuMzIsLTUyLjQ1IDMyMi4wOSwtNDMuMDMiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMzI0LjMsLTQwLjMgMzE0LjU3LC0zNi4xIDMxOS41NSwtNDUuNDUgMzI0LjMsLTQwLjMiLz4KPC9nPgo8IS0tIGhvc3RzIC0tPgo8ZyBpZD0ibm9kZTEzIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5ob3N0czwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS1kYXNoYXJyYXk9IjEsNSIgcG9pbnRzPSI1MTYuNSwtMzYgMzc5LjUsLTM2IDM3OS41LDAgNTE2LjUsMCA1MTYuNSwtMzYiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iNDQ4IiB5PSItMTQuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj5ob3N0cyAoYmxvYiA3Ni4uLik8L3RleHQ+CjwvZz4KPCEtLSBldGMmIzQ1OyZndDtob3N0cyAtLT4KPGcgaWQ9ImVkZ2UxMyIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+ZXRjJiM0NTsmZ3Q7aG9zdHM8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNMzkwLjc5LC03MS43QzQwMC4xNywtNjMuMDUgNDExLjY4LC01Mi40NSA0MjEuOTEsLTQzLjAzIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjQyNC40NSwtNDUuNDUgNDI5LjQzLC0zNi4xIDQxOS43LC00MC4zIDQyNC40NSwtNDUuNDUiLz4KPC9nPgo8L2c+Cjwvc3ZnPgo=" />
</center>
<p>Remember that after GC, we want this set of objects:</p>
<center>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8IS0tIEdlbmVyYXRlZCBieSBncmFwaHZpeiB2ZXJzaW9uIDIuNDIuNCAoMCkKIC0tPgo8IS0tIFRpdGxlOiBhZnRlciBybSBhbmQgZ2MgUGFnZXM6IDEgLS0+Cjxzdmcgd2lkdGg9IjI5NHB0IiBoZWlnaHQ9IjI2MHB0Igogdmlld0JveD0iMC4wMCAwLjAwIDI5NC4wMCAyNjAuMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgo8ZyBpZD0iZ3JhcGgwIiBjbGFzcz0iZ3JhcGgiIHRyYW5zZm9ybT0ic2NhbGUoMSAxKSByb3RhdGUoMCkgdHJhbnNsYXRlKDQgMjU2KSI+Cjx0aXRsZT5hZnRlciBybSBhbmQgZ2M8L3RpdGxlPgo8IS0tIHNhdmVzIC0tPgo8ZyBpZD0ibm9kZTEiIGNsYXNzPSJub2RlIj4KPHRpdGxlPnNhdmVzPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSI5NSwtMjUyIDM5LC0yNTIgMzksLTIxNiA5NSwtMjE2IDk1LC0yNTIiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iNjciIHk9Ii0yMzAuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj5zYXZlczwvdGV4dD4KPC9nPgo8IS0tIHNhdmUzIC0tPgo8ZyBpZD0ibm9kZTIiIGNsYXNzPSJub2RlIj4KPHRpdGxlPnNhdmUzPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxMzQsLTE4MCAwLC0xODAgMCwtMTQ0IDEzNCwtMTQ0IDEzNCwtMTgwIi8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjY3IiB5PSItMTU4LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+MjAyNCYjNDU7MTEuLi4gKGMxLi4uKTwvdGV4dD4KPC9nPgo8IS0tIHNhdmVzJiM0NTsmZ3Q7c2F2ZTMgLS0+CjxnIGlkPSJlZGdlMSIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+c2F2ZXMmIzQ1OyZndDtzYXZlMzwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS1kYXNoYXJyYXk9IjEsNSIgZD0iTTY3LC0yMTUuN0M2NywtMjA3Ljk4IDY3LC0xOTguNzEgNjcsLTE5MC4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSI3MC41LC0xOTAuMSA2NywtMTgwLjEgNjMuNSwtMTkwLjEgNzAuNSwtMTkwLjEiLz4KPC9nPgo8IS0tIHNhdmUxIC0tPgo8ZyBpZD0ibm9kZTMiIGNsYXNzPSJub2RlIj4KPHRpdGxlPnNhdmUxPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIyODYsLTE4MCAxNTIsLTE4MCAxNTIsLTE0NCAyODYsLTE0NCAyODYsLTE4MCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIyMTkiIHk9Ii0xNTguMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4yMDI0JiM0NTswOS4uLiAoYTAuLi4pPC90ZXh0Pgo8L2c+CjwhLS0gc2F2ZTMmIzQ1OyZndDtzYXZlMSAtLT4KPGcgaWQ9ImVkZ2UyIiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5zYXZlMyYjNDU7Jmd0O3NhdmUxPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTEzNC4wOSwtMTYyQzEzNi41NywtMTYyIDEzOS4wNCwtMTYyIDE0MS41MSwtMTYyIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE0MS42NywtMTY1LjUgMTUxLjY3LC0xNjIgMTQxLjY3LC0xNTguNSAxNDEuNjcsLTE2NS41Ii8+CjwvZz4KPCEtLSByb290MyAtLT4KPGcgaWQ9Im5vZGU0IiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5yb290MzwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iOTQsLTEwOCA0MCwtMTA4IDQwLC03MiA5NCwtNzIgOTQsLTEwOCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSI2NyIgeT0iLTg2LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+LzwvdGV4dD4KPC9nPgo8IS0tIHNhdmUzJiM0NTsmZ3Q7cm9vdDMgLS0+CjxnIGlkPSJlZGdlMyIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+c2F2ZTMmIzQ1OyZndDtyb290MzwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik02NywtMTQzLjdDNjcsLTEzNS45OCA2NywtMTI2LjcxIDY3LC0xMTguMTEiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iNzAuNSwtMTE4LjEgNjcsLTEwOC4xIDYzLjUsLTExOC4xIDcwLjUsLTExOC4xIi8+CjwvZz4KPCEtLSByb290MSAtLT4KPGcgaWQ9Im5vZGU2IiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5yb290MTwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjQ2LC0xMDggMTkyLC0xMDggMTkyLC03MiAyNDYsLTcyIDI0NiwtMTA4Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjIxOSIgeT0iLTg2LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+LzwvdGV4dD4KPC9nPgo8IS0tIHNhdmUxJiM0NTsmZ3Q7cm9vdDEgLS0+CjxnIGlkPSJlZGdlNSIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+c2F2ZTEmIzQ1OyZndDtyb290MTwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0yMTksLTE0My43QzIxOSwtMTM1Ljk4IDIxOSwtMTI2LjcxIDIxOSwtMTE4LjExIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjIyMi41LC0xMTguMSAyMTksLTEwOC4xIDIxNS41LC0xMTguMSAyMjIuNSwtMTE4LjEiLz4KPC9nPgo8IS0tIGRvdDMgLS0+CjxnIGlkPSJub2RlNSIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+ZG90MzwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iOTQsLTM2IDQwLC0zNiA0MCwwIDk0LDAgOTQsLTM2Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjY3IiB5PSItMTQuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4uLi48L3RleHQ+CjwvZz4KPCEtLSByb290MyYjNDU7Jmd0O2RvdDMgLS0+CjxnIGlkPSJlZGdlNCIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+cm9vdDMmIzQ1OyZndDtkb3QzPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTY3LC03MS43QzY3LC02My45OCA2NywtNTQuNzEgNjcsLTQ2LjExIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjcwLjUsLTQ2LjEgNjcsLTM2LjEgNjMuNSwtNDYuMSA3MC41LC00Ni4xIi8+CjwvZz4KPCEtLSBkb3QxIC0tPgo8ZyBpZD0ibm9kZTciIGNsYXNzPSJub2RlIj4KPHRpdGxlPmRvdDE8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjI0NiwtMzYgMTkyLC0zNiAxOTIsMCAyNDYsMCAyNDYsLTM2Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjIxOSIgeT0iLTE0LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+Li4uPC90ZXh0Pgo8L2c+CjwhLS0gcm9vdDEmIzQ1OyZndDtkb3QxIC0tPgo8ZyBpZD0iZWRnZTYiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnJvb3QxJiM0NTsmZ3Q7ZG90MTwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0yMTksLTcxLjdDMjE5LC02My45OCAyMTksLTU0LjcxIDIxOSwtNDYuMTEiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjIyLjUsLTQ2LjEgMjE5LC0zNi4xIDIxNS41LC00Ni4xIDIyMi41LC00Ni4xIi8+CjwvZz4KPC9nPgo8L3N2Zz4K" />
</center>
<p>Unfortunately, the current GC fundamentally doesn’t work that way
(and that’s the issue), and it might only remove the
<code>2024-11... (c1...)</code> and <code>2024-10...</code> commits and
<code>hosts (blob 76...)</code>, leaving us with:</p>
<center>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8IS0tIEdlbmVyYXRlZCBieSBncmFwaHZpeiB2ZXJzaW9uIDIuNDIuNCAoMCkKIC0tPgo8IS0tIFRpdGxlOiBkYW5nbGluZyBhZnRlciBnYyBQYWdlczogMSAtLT4KPHN2ZyB3aWR0aD0iMzcycHQiIGhlaWdodD0iNDA0cHQiCiB2aWV3Qm94PSIwLjAwIDAuMDAgMzcxLjUwIDQwNC4wMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CjxnIGlkPSJncmFwaDAiIGNsYXNzPSJncmFwaCIgdHJhbnNmb3JtPSJzY2FsZSgxIDEpIHJvdGF0ZSgwKSB0cmFuc2xhdGUoNCA0MDApIj4KPHRpdGxlPmRhbmdsaW5nIGFmdGVyIGdjPC90aXRsZT4KPCEtLSBzYXZlcyAtLT4KPGcgaWQ9Im5vZGUxIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5zYXZlczwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iOTUsLTM5NiAzOSwtMzk2IDM5LC0zNjAgOTUsLTM2MCA5NSwtMzk2Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjY3IiB5PSItMzc0LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+c2F2ZXM8L3RleHQ+CjwvZz4KPCEtLSBzYXZlMyAtLT4KPGcgaWQ9Im5vZGUyIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5zYXZlMzwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTM0LC0zMjQgMCwtMzI0IDAsLTI4OCAxMzQsLTI4OCAxMzQsLTMyNCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSI2NyIgeT0iLTMwMi4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPjIwMjQmIzQ1OzExLi4uIChjMS4uLik8L3RleHQ+CjwvZz4KPCEtLSBzYXZlcyYjNDU7Jmd0O3NhdmUzIC0tPgo8ZyBpZD0iZWRnZTEiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnNhdmVzJiM0NTsmZ3Q7c2F2ZTM8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBzdHJva2UtZGFzaGFycmF5PSIxLDUiIGQ9Ik02NywtMzU5LjdDNjcsLTM1MS45OCA2NywtMzQyLjcxIDY3LC0zMzQuMTEiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iNzAuNSwtMzM0LjEgNjcsLTMyNC4xIDYzLjUsLTMzNC4xIDcwLjUsLTMzNC4xIi8+CjwvZz4KPCEtLSBzYXZlMSAtLT4KPGcgaWQ9Im5vZGUzIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5zYXZlMTwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjg2LC0zMjQgMTUyLC0zMjQgMTUyLC0yODggMjg2LC0yODggMjg2LC0zMjQiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMjE5IiB5PSItMzAyLjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+MjAyNCYjNDU7MDkuLi4gKGEwLi4uKTwvdGV4dD4KPC9nPgo8IS0tIHNhdmUzJiM0NTsmZ3Q7c2F2ZTEgLS0+CjxnIGlkPSJlZGdlMiIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+c2F2ZTMmIzQ1OyZndDtzYXZlMTwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0xMzQuMDksLTMwNkMxMzYuNTcsLTMwNiAxMzkuMDQsLTMwNiAxNDEuNTEsLTMwNiIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxNDEuNjcsLTMwOS41IDE1MS42NywtMzA2IDE0MS42NywtMzAyLjUgMTQxLjY3LC0zMDkuNSIvPgo8L2c+CjwhLS0gcm9vdDMgLS0+CjxnIGlkPSJub2RlNCIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+cm9vdDM8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9Ijk0LC0yNTIgNDAsLTI1MiA0MCwtMjE2IDk0LC0yMTYgOTQsLTI1MiIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSI2NyIgeT0iLTIzMC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi88L3RleHQ+CjwvZz4KPCEtLSBzYXZlMyYjNDU7Jmd0O3Jvb3QzIC0tPgo8ZyBpZD0iZWRnZTMiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnNhdmUzJiM0NTsmZ3Q7cm9vdDM8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNNjcsLTI4Ny43QzY3LC0yNzkuOTggNjcsLTI3MC43MSA2NywtMjYyLjExIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjcwLjUsLTI2Mi4xIDY3LC0yNTIuMSA2My41LC0yNjIuMSA3MC41LC0yNjIuMSIvPgo8L2c+CjwhLS0gcm9vdDEgLS0+CjxnIGlkPSJub2RlNiIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+cm9vdDE8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjI0NiwtMjUyIDE5MiwtMjUyIDE5MiwtMjE2IDI0NiwtMjE2IDI0NiwtMjUyIi8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjIxOSIgeT0iLTIzMC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi88L3RleHQ+CjwvZz4KPCEtLSBzYXZlMSYjNDU7Jmd0O3Jvb3QxIC0tPgo8ZyBpZD0iZWRnZTUiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnNhdmUxJiM0NTsmZ3Q7cm9vdDE8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNMjE5LC0yODcuN0MyMTksLTI3OS45OCAyMTksLTI3MC43MSAyMTksLTI2Mi4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIyMjIuNSwtMjYyLjEgMjE5LC0yNTIuMSAyMTUuNSwtMjYyLjEgMjIyLjUsLTI2Mi4xIi8+CjwvZz4KPCEtLSBkb3QzIC0tPgo8ZyBpZD0ibm9kZTUiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmRvdDM8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9Ijk0LC0xODAgNDAsLTE4MCA0MCwtMTQ0IDk0LC0xNDQgOTQsLTE4MCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSI2NyIgeT0iLTE1OC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi4uLjwvdGV4dD4KPC9nPgo8IS0tIHJvb3QzJiM0NTsmZ3Q7ZG90MyAtLT4KPGcgaWQ9ImVkZ2U0IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5yb290MyYjNDU7Jmd0O2RvdDM8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNNjcsLTIxNS43QzY3LC0yMDcuOTggNjcsLTE5OC43MSA2NywtMTkwLjExIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjcwLjUsLTE5MC4xIDY3LC0xODAuMSA2My41LC0xOTAuMSA3MC41LC0xOTAuMSIvPgo8L2c+CjwhLS0gZG90MSAtLT4KPGcgaWQ9Im5vZGU3IiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5kb3QxPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIyNDYsLTE4MCAxOTIsLTE4MCAxOTIsLTE0NCAyNDYsLTE0NCAyNDYsLTE4MCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIyMTkiIHk9Ii0xNTguMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4uLi48L3RleHQ+CjwvZz4KPCEtLSByb290MSYjNDU7Jmd0O2RvdDEgLS0+CjxnIGlkPSJlZGdlNiIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+cm9vdDEmIzQ1OyZndDtkb3QxPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTIxOSwtMjE1LjdDMjE5LC0yMDcuOTggMjE5LC0xOTguNzEgMjE5LC0xOTAuMTEiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjIyLjUsLTE5MC4xIDIxOSwtMTgwLjEgMjE1LjUsLTE5MC4xIDIyMi41LC0xOTAuMSIvPgo8L2c+CjwhLS0gZXRjIC0tPgo8ZyBpZD0ibm9kZTgiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmV0YzwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjgwLC0xMDggMTU4LC0xMDggMTU4LC03MiAyODAsLTcyIDI4MCwtMTA4Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjIxOSIgeT0iLTg2LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+ZXRjLyAodHJlZSBlZS4uLik8L3RleHQ+CjwvZz4KPCEtLSBkb3QxJiM0NTsmZ3Q7ZXRjIC0tPgo8ZyBpZD0iZWRnZTkiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPmRvdDEmIzQ1OyZndDtldGM8L3RpdGxlPgo8L2c+CjwhLS0gZnN0YWIgLS0+CjxnIGlkPSJub2RlOSIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+ZnN0YWI8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjIwOC41LC0zNiA3Ny41LC0zNiA3Ny41LDAgMjA4LjUsMCAyMDguNSwtMzYiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMTQzIiB5PSItMTQuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj5mc3RhYiAoYmxvYiBmOS4uLik8L3RleHQ+CjwvZz4KPCEtLSBldGMmIzQ1OyZndDtmc3RhYiAtLT4KPGcgaWQ9ImVkZ2U3IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5ldGMmIzQ1OyZndDtmc3RhYjwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0yMDAuMjEsLTcxLjdDMTkwLjgzLC02My4wNSAxNzkuMzIsLTUyLjQ1IDE2OS4wOSwtNDMuMDMiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTcxLjMsLTQwLjMgMTYxLjU3LC0zNi4xIDE2Ni41NSwtNDUuNDUgMTcxLjMsLTQwLjMiLz4KPC9nPgo8IS0tIGhvc3RzIC0tPgo8ZyBpZD0ibm9kZTEwIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5ob3N0czwvdGl0bGU+CjwvZz4KPCEtLSBldGMmIzQ1OyZndDtob3N0cyAtLT4KPGcgaWQ9ImVkZ2U4IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5ldGMmIzQ1OyZndDtob3N0czwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0yMzcuNzksLTcxLjdDMjQ3LjE3LC02My4wNSAyNTguNjgsLTUyLjQ1IDI2OC45MSwtNDMuMDMiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjcxLjQ1LC00NS40NSAyNzYuNDMsLTM2LjEgMjY2LjcsLTQwLjMgMjcxLjQ1LC00NS40NSIvPgo8L2c+CjwvZz4KPC9zdmc+Cg==" />
</center>
<p>See <a href="#how-gc-before-0.33.5-can-create-dangling-references">“How gc
(before 0.33.5) can create dangling references”</a> below for further
details regarding the cause.</p>
<h3 id="effect-on-bup-get">Effect on <code>bup get</code></h3>
<p>If you run <code>bup get</code> now to write to this repository, and
it encounters the <code>etc/</code> tree, originally from
<code>save 2</code>, in the set of objects to transfer, it will see that
it already exists (because it <em>is</em> still in the repository’s
packfiles), and as explained earlier, will assume it’s complete and
re-use it, without delving further. This will leave the repository
broken, because now, whatever <code>get</code> is building will have a
reference to the <code>etc/</code> tree that itself refers to the
missing <code>hosts</code> blob.</p>
<h3 id="effect-on-bup-save">Effect on <code>bup save</code></h3>
<p>Similarly, if <code>bup save</code> encounters the <code>etc/</code>
tree, originally from <code>save 2</code>, in the <code>index</code>,
and sees that it already exists in the repository, it will prune its
index traversal at that point, and re-use the existing, broken
<code>etc/ (tree ee)</code> object without noticing that the tree is
broken.</p>
<p>This can (also) happen if a save is aborted in the middle,
<code>gc</code> is run to clean up the repo and remove unreferenced
objects, and some objects that are referenced by the index (say the
<code>etc/</code> tree) are not removed by the <code>gc</code>, while
some other objects (say <code>hosts</code>) that are referred to by the
preserved objects are themselves removed.</p>
<p>However, if the index doesn’t exist (say due to a
<code>bup index --clear</code>), then it shouldn’t be possible for
<code>bup save</code> to create the problem, because when saving a path
it creates all the objects the path is comprised of, from the bottom
(leaves) up, and then checks to see if the object exists in the
repository. This process would encounter <code>hosts</code> first, and
store it, fixing the broken <code>etc/</code> tree before it’s
reached.</p>
<h3 id="how-gc-before-0.33.5-can-create-dangling-references">How gc
(before 0.33.5) can create dangling references</h3>
<p>There are actually two reasons it can do this.</p>
<h4 id="probabilistic-liveness-detection">Probabilistic liveness
detection</h4>
<p>The first reason is that the garbage collection before 0.33.5 tracks
tree and commit objects probabilistically, not precisely. It determines
whether they’re live via a Bloom filter populated by a reachability walk
through all refs. (As of 0.33.5 trees and commits are tracked
precisely.)</p>
<p>Because <a href="https://en.wikipedia.org/wiki/Bloom_filter">Bloom
filters</a> can only say “definitely not present” and “maybe present”,
it means that some other random object can cause
<code>/etc (tree ee...)</code> to be considered “maybe present” (live)
when it isn’t actually reachable (wasn’t traversed during the walk).</p>
<p>First, the Bloom filter is populated with live objects. Each live
object sets N bits in the Bloom filter (just 2 here):</p>
<center>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8IS0tIEdlbmVyYXRlZCBieSBncmFwaHZpeiB2ZXJzaW9uIDIuNDIuNCAoMCkKIC0tPgo8IS0tIFRpdGxlOiBibG9vbSBzZXQgUGFnZXM6IDEgLS0+Cjxzdmcgd2lkdGg9IjM1OXB0IiBoZWlnaHQ9IjE1NXB0Igogdmlld0JveD0iMC4wMCAwLjAwIDM1OS4wMCAxNTUuMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgo8ZyBpZD0iZ3JhcGgwIiBjbGFzcz0iZ3JhcGgiIHRyYW5zZm9ybT0ic2NhbGUoMSAxKSByb3RhdGUoMCkgdHJhbnNsYXRlKDQgMTUxKSI+Cjx0aXRsZT5ibG9vbSBzZXQ8L3RpdGxlPgo8IS0tIGgxIC0tPgo8ZyBpZD0ibm9kZTEiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmgxPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxODEsLTEwNy41IDAsLTEwNy41IDAsLTcxLjUgMTgxLC03MS41IDE4MSwtMTA3LjUiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iOTAuNSIgeT0iLTg1LjgiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+c29tZXRoaW5nIChibG9iIGFlMC4uLik8L3RleHQ+CjwvZz4KPCEtLSBibG9vbTIgLS0+CjxnIGlkPSJub2RlMiIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+Ymxvb20yPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIzMjUsLTEyNS41IDMyNSwtMTQ2LjUgMzUxLC0xNDYuNSAzNTEsLTEyNS41IDMyNSwtMTI1LjUiLz4KPHRleHQgdGV4dC1hbmNob3I9InN0YXJ0IiB4PSIzMjgiIHk9Ii0xMzIuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj5iaXQ8L3RleHQ+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMzI1LC0xMDQuNSAzMjUsLTEyNS41IDM1MSwtMTI1LjUgMzUxLC0xMDQuNSAzMjUsLTEwNC41Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJzdGFydCIgeD0iMzMzIiB5PSItMTExLjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+MDwvdGV4dD4KPHBvbHlnb24gZmlsbD0ibGltZSIgc3Ryb2tlPSJ0cmFuc3BhcmVudCIgcG9pbnRzPSIzMjUsLTgzLjUgMzI1LC0xMDQuNSAzNTEsLTEwNC41IDM1MSwtODMuNSAzMjUsLTgzLjUiLz4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIzMjUsLTgzLjUgMzI1LC0xMDQuNSAzNTEsLTEwNC41IDM1MSwtODMuNSAzMjUsLTgzLjUiLz4KPHRleHQgdGV4dC1hbmNob3I9InN0YXJ0IiB4PSIzMzMiIHk9Ii05MC4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPjE8L3RleHQ+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMzI1LC02Mi41IDMyNSwtODMuNSAzNTEsLTgzLjUgMzUxLC02Mi41IDMyNSwtNjIuNSIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ic3RhcnQiIHg9IjMzMyIgeT0iLTY5LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+MjwvdGV4dD4KPHBvbHlnb24gZmlsbD0ibGltZSIgc3Ryb2tlPSJ0cmFuc3BhcmVudCIgcG9pbnRzPSIzMjUsLTQxLjUgMzI1LC02Mi41IDM1MSwtNjIuNSAzNTEsLTQxLjUgMzI1LC00MS41Ii8+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMzI1LC00MS41IDMyNSwtNjIuNSAzNTEsLTYyLjUgMzUxLC00MS41IDMyNSwtNDEuNSIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ic3RhcnQiIHg9IjMzMyIgeT0iLTQ4LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+MzwvdGV4dD4KPHBvbHlnb24gZmlsbD0ibGltZSIgc3Ryb2tlPSJ0cmFuc3BhcmVudCIgcG9pbnRzPSIzMjUsLTIwLjUgMzI1LC00MS41IDM1MSwtNDEuNSAzNTEsLTIwLjUgMzI1LC0yMC41Ii8+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMzI1LC0yMC41IDMyNSwtNDEuNSAzNTEsLTQxLjUgMzUxLC0yMC41IDMyNSwtMjAuNSIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ic3RhcnQiIHg9IjMzMyIgeT0iLTI3LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+NDwvdGV4dD4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIzMjUsMC41IDMyNSwtMjAuNSAzNTEsLTIwLjUgMzUxLDAuNSAzMjUsMC41Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJzdGFydCIgeD0iMzMxIiB5PSItNi4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPi4uLjwvdGV4dD4KPC9nPgo8IS0tIGgxJiM0NTsmZ3Q7Ymxvb20yIC0tPgo8ZyBpZD0iZWRnZTEiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPmgxOmUmIzQ1OyZndDtibG9vbTI6dzwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0xODEsLTg5LjVDMjQxLjU0LC04OS41IDI1OS4wOCwtOTMuOTcgMzE0LjkxLC05NC40NiIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIzMTQuOTksLTk3Ljk2IDMyNSwtOTQuNSAzMTUuMDIsLTkwLjk2IDMxNC45OSwtOTcuOTYiLz4KPC9nPgo8IS0tIGgxJiM0NTsmZ3Q7Ymxvb20yIC0tPgo8ZyBpZD0iZWRnZTIiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPmgxOmUmIzQ1OyZndDtibG9vbTI6dzwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0xODEsLTg5LjVDMjQzLjcsLTg5LjUgMjU3LjQzLC01NS40IDMxNC45NywtNTEuODEiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMzE1LjExLC01NS4zIDMyNSwtNTEuNSAzMTQuOSwtNDguMzEgMzE1LjExLC01NS4zIi8+CjwvZz4KPCEtLSBoMiAtLT4KPGcgaWQ9Im5vZGUzIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5oMjwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTcxLC01MS41IDEwLC01MS41IDEwLC0xNS41IDE3MSwtMTUuNSAxNzEsLTUxLjUiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iOTAuNSIgeT0iLTI5LjgiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+YW5vdGhlciAodHJlZSAyNzMuLi4pPC90ZXh0Pgo8L2c+CjwhLS0gaDImIzQ1OyZndDtibG9vbTIgLS0+CjxnIGlkPSJlZGdlMyIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+aDI6ZSYjNDU7Jmd0O2Jsb29tMjp3PC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTE3Mi41LC0zMy41QzIzNy4yOCwtMzMuNSAyNTQuOTksLTQ5LjcyIDMxNC45OSwtNTEuMzciLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMzE0Ljk1LC01NC44NyAzMjUsLTUxLjUgMzE1LjA1LC00Ny44NyAzMTQuOTUsLTU0Ljg3Ii8+CjwvZz4KPCEtLSBoMiYjNDU7Jmd0O2Jsb29tMiAtLT4KPGcgaWQ9ImVkZ2U0IiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5oMjplJiM0NTsmZ3Q7Ymxvb20yOnc8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNMTcyLjUsLTMzLjVDMjM2LjcyLC0zMy41IDI1NS4yOCwtMzAuODEgMzE0LjY4LC0zMC41MiIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIzMTUuMDEsLTM0LjAyIDMyNSwtMzAuNSAzMTQuOTksLTI3LjAyIDMxNS4wMSwtMzQuMDIiLz4KPC9nPgo8L2c+Cjwvc3ZnPgo=" />
</center>
<p>Then the liveness check can erroneously return true if say
<code>etc/ (tree ee...)</code> happens to map to N bits that have been
set by other objects:</p>
<center>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8IS0tIEdlbmVyYXRlZCBieSBncmFwaHZpeiB2ZXJzaW9uIDIuNDIuNCAoMCkKIC0tPgo8IS0tIFRpdGxlOiBibG9vbSBnZXQgUGFnZXM6IDEgLS0+Cjxzdmcgd2lkdGg9IjIyOHB0IiBoZWlnaHQ9IjE1NXB0Igogdmlld0JveD0iMC4wMCAwLjAwIDIyOC4wMCAxNTUuMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgo8ZyBpZD0iZ3JhcGgwIiBjbGFzcz0iZ3JhcGgiIHRyYW5zZm9ybT0ic2NhbGUoMSAxKSByb3RhdGUoMCkgdHJhbnNsYXRlKDQgMTUxKSI+Cjx0aXRsZT5ibG9vbSBnZXQ8L3RpdGxlPgo8IS0tIGJsb29tMiAtLT4KPGcgaWQ9Im5vZGUxIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5ibG9vbTI8L3RpdGxlPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE5NCwtMTI1LjUgMTk0LC0xNDYuNSAyMjAsLTE0Ni41IDIyMCwtMTI1LjUgMTk0LC0xMjUuNSIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ic3RhcnQiIHg9IjE5NyIgeT0iLTEzMi4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPmJpdDwvdGV4dD4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxOTQsLTEwNC41IDE5NCwtMTI1LjUgMjIwLC0xMjUuNSAyMjAsLTEwNC41IDE5NCwtMTA0LjUiLz4KPHRleHQgdGV4dC1hbmNob3I9InN0YXJ0IiB4PSIyMDIiIHk9Ii0xMTEuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4wPC90ZXh0Pgo8cG9seWdvbiBmaWxsPSJsaW1lIiBzdHJva2U9InRyYW5zcGFyZW50IiBwb2ludHM9IjE5NCwtODMuNSAxOTQsLTEwNC41IDIyMCwtMTA0LjUgMjIwLC04My41IDE5NCwtODMuNSIvPgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE5NCwtODMuNSAxOTQsLTEwNC41IDIyMCwtMTA0LjUgMjIwLC04My41IDE5NCwtODMuNSIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ic3RhcnQiIHg9IjIwMiIgeT0iLTkwLjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+MTwvdGV4dD4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxOTQsLTYyLjUgMTk0LC04My41IDIyMCwtODMuNSAyMjAsLTYyLjUgMTk0LC02Mi41Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJzdGFydCIgeD0iMjAyIiB5PSItNjkuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4yPC90ZXh0Pgo8cG9seWdvbiBmaWxsPSJsaW1lIiBzdHJva2U9InRyYW5zcGFyZW50IiBwb2ludHM9IjE5NCwtNDEuNSAxOTQsLTYyLjUgMjIwLC02Mi41IDIyMCwtNDEuNSAxOTQsLTQxLjUiLz4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxOTQsLTQxLjUgMTk0LC02Mi41IDIyMCwtNjIuNSAyMjAsLTQxLjUgMTk0LC00MS41Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJzdGFydCIgeD0iMjAyIiB5PSItNDguMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4zPC90ZXh0Pgo8cG9seWdvbiBmaWxsPSJsaW1lIiBzdHJva2U9InRyYW5zcGFyZW50IiBwb2ludHM9IjE5NCwtMjAuNSAxOTQsLTQxLjUgMjIwLC00MS41IDIyMCwtMjAuNSAxOTQsLTIwLjUiLz4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxOTQsLTIwLjUgMTk0LC00MS41IDIyMCwtNDEuNSAyMjAsLTIwLjUgMTk0LC0yMC41Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJzdGFydCIgeD0iMjAyIiB5PSItMjcuMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj40PC90ZXh0Pgo8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjE5NCwwLjUgMTk0LC0yMC41IDIyMCwtMjAuNSAyMjAsMC41IDE5NCwwLjUiLz4KPHRleHQgdGV4dC1hbmNob3I9InN0YXJ0IiB4PSIyMDAiIHk9Ii02LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+Li4uPC90ZXh0Pgo8L2c+CjwhLS0gZXRjIC0tPgo8ZyBpZD0ibm9kZTIiIGNsYXNzPSJub2RlIj4KPHRpdGxlPmV0YzwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTIyLC04MC41IDAsLTgwLjUgMCwtNDQuNSAxMjIsLTQ0LjUgMTIyLC04MC41Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjYxIiB5PSItNTguOCIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj5ldGMvICh0cmVlIGVlLi4uKTwvdGV4dD4KPC9nPgo8IS0tIGJsb29tMiYjNDU7Jmd0O2V0YyAtLT4KPGcgaWQ9ImVkZ2UxIiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5ibG9vbTI6YjEmIzQ1OyZndDtldGM6ZTwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0xOTQsLTk0LjVDMTYyLjY4LC05NC41IDE1Ny44LC02OC44OSAxMzIuMDUsLTYzLjQ5Ii8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjEzMi4zLC02MCAxMjIsLTYyLjUgMTMxLjYxLC02Ni45NyAxMzIuMywtNjAiLz4KPC9nPgo8IS0tIGJsb29tMiYjNDU7Jmd0O2V0YyAtLT4KPGcgaWQ9ImVkZ2UyIiBjbGFzcz0iZWRnZSI+Cjx0aXRsZT5ibG9vbTI6YjQmIzQ1OyZndDtldGM6ZTwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0xOTQsLTMwLjVDMTYyLjY4LC0zMC41IDE1Ny44LC01Ni4xMSAxMzIuMDUsLTYxLjUxIi8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjEzMS42MSwtNTguMDMgMTIyLC02Mi41IDEzMi4zLC02NSAxMzEuNjEsLTU4LjAzIi8+CjwvZz4KPC9nPgo8L3N2Zz4K" />
</center>
<h4 id="pack-file-rewrite-threshold">Pack file rewrite threshold</h4>
<p>It’s also possible that <code>etc/ (tree ee...)</code> and
<code>hosts (blob 76...)</code> end up in separate pack files (depending
on how/when they were written), and the pack file containing
<code>hosts</code> ends up being rewritten, dropping <code>hosts</code>
(because it has more dead objects than the threshold), but the pack file
containing <code>etc/ (tree ee)</code> does not (because it had enough
live objects to survive intact).</p>
<h2 id="bug-3-bup-get">Bug #3 (bup get)</h2>
<p>While working on all of this, we noticed that <code>bup get</code>
can also leave the repository with incomplete trees if it is aborted at
the wrong time during a transfer. Imagine we have a save like this:</p>
<center>
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8IS0tIEdlbmVyYXRlZCBieSBncmFwaHZpeiB2ZXJzaW9uIDIuNDIuNCAoMCkKIC0tPgo8IS0tIFRpdGxlOiBidXAgZ2V0IGJ1ZyBzYXZlIFBhZ2VzOiAxIC0tPgo8c3ZnIHdpZHRoPSIyMjZwdCIgaGVpZ2h0PSIyNjBwdCIKIHZpZXdCb3g9IjAuMDAgMC4wMCAyMjUuNTAgMjYwLjAwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPGcgaWQ9ImdyYXBoMCIgY2xhc3M9ImdyYXBoIiB0cmFuc2Zvcm09InNjYWxlKDEgMSkgcm90YXRlKDApIHRyYW5zbGF0ZSg0IDI1NikiPgo8dGl0bGU+YnVwIGdldCBidWcgc2F2ZTwvdGl0bGU+CjwhLS0gcm9vdCAtLT4KPGcgaWQ9Im5vZGUxIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5yb290PC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxNjEsLTI1MiA1NSwtMjUyIDU1LC0yMTYgMTYxLC0yMTYgMTYxLC0yNTIiLz4KPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMTA4IiB5PSItMjMwLjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+YyYjNDU7MSAoY29tbWl0KTwvdGV4dD4KPC9nPgo8IS0tIGRpcjEgLS0+CjxnIGlkPSJub2RlMiIgY2xhc3M9Im5vZGUiPgo8dGl0bGU+ZGlyMTwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTQwLjUsLTE4MCA3NS41LC0xODAgNzUuNSwtMTQ0IDE0MC41LC0xNDQgMTQwLjUsLTE4MCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIxMDgiIHk9Ii0xNTguMyIgZm9udC1mYW1pbHk9IlRpbWVzLHNlcmlmIiBmb250LXNpemU9IjE0LjAwIj4vICh0cmVlKTwvdGV4dD4KPC9nPgo8IS0tIHJvb3QmIzQ1OyZndDtkaXIxIC0tPgo8ZyBpZD0iZWRnZTEiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPnJvb3QmIzQ1OyZndDtkaXIxPC90aXRsZT4KPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgZD0iTTEwOCwtMjE1LjdDMTA4LC0yMDcuOTggMTA4LC0xOTguNzEgMTA4LC0xOTAuMTEiLz4KPHBvbHlnb24gZmlsbD0iYmxhY2siIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMTExLjUsLTE5MC4xIDEwOCwtMTgwLjEgMTA0LjUsLTE5MC4xIDExMS41LC0xOTAuMSIvPgo8L2c+CjwhLS0gZGlyMiAtLT4KPGcgaWQ9Im5vZGUzIiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5kaXIyPC90aXRsZT4KPHBvbHlnb24gZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxNTEuNSwtMTA4IDY0LjUsLTEwOCA2NC41LC03MiAxNTEuNSwtNzIgMTUxLjUsLTEwOCIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSIxMDgiIHk9Ii04Ni4zIiBmb250LWZhbWlseT0iVGltZXMsc2VyaWYiIGZvbnQtc2l6ZT0iMTQuMDAiPmV0Yy8gKHRyZWUpPC90ZXh0Pgo8L2c+CjwhLS0gZGlyMSYjNDU7Jmd0O2RpcjIgLS0+CjxnIGlkPSJlZGdlMiIgY2xhc3M9ImVkZ2UiPgo8dGl0bGU+ZGlyMSYjNDU7Jmd0O2RpcjI8L3RpdGxlPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBkPSJNMTA4LC0xNDMuN0MxMDgsLTEzNS45OCAxMDgsLTEyNi43MSAxMDgsLTExOC4xMSIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxMTEuNSwtMTE4LjEgMTA4LC0xMDguMSAxMDQuNSwtMTE4LjEgMTExLjUsLTExOC4xIi8+CjwvZz4KPCEtLSBmaWxlMiAtLT4KPGcgaWQ9Im5vZGU0IiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5maWxlMjwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iOTgsLTM2IDAsLTM2IDAsMCA5OCwwIDk4LC0zNiIvPgo8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSI0OSIgeT0iLTE0LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+ZnN0YWIgKGJsb2IpPC90ZXh0Pgo8L2c+CjwhLS0gZGlyMiYjNDU7Jmd0O2ZpbGUyIC0tPgo8ZyBpZD0iZWRnZTMiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPmRpcjImIzQ1OyZndDtmaWxlMjwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik05My40MiwtNzEuN0M4Ni4zNCwtNjMuMyA3Ny43MiwtNTMuMDcgNjkuOTUsLTQzLjg2Ii8+Cjxwb2x5Z29uIGZpbGw9ImJsYWNrIiBzdHJva2U9ImJsYWNrIiBwb2ludHM9IjcyLjU0LC00MS40OSA2My40MiwtMzYuMSA2Ny4xOSwtNDYuMDEgNzIuNTQsLTQxLjQ5Ii8+CjwvZz4KPCEtLSBmaWxlMSAtLT4KPGcgaWQ9Im5vZGU1IiBjbGFzcz0ibm9kZSI+Cjx0aXRsZT5maWxlMTwvdGl0bGU+Cjxwb2x5Z29uIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHBvaW50cz0iMjE3LjUsLTM2IDExNi41LC0zNiAxMTYuNSwwIDIxNy41LDAgMjE3LjUsLTM2Ii8+Cjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjE2NyIgeT0iLTE0LjMiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC1zaXplPSIxNC4wMCI+aG9zdHMgKGJsb2IpPC90ZXh0Pgo8L2c+CjwhLS0gZGlyMiYjNDU7Jmd0O2ZpbGUxIC0tPgo8ZyBpZD0iZWRnZTQiIGNsYXNzPSJlZGdlIj4KPHRpdGxlPmRpcjImIzQ1OyZndDtmaWxlMTwvdGl0bGU+CjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIGQ9Ik0xMjIuNTgsLTcxLjdDMTI5LjY2LC02My4zIDEzOC4yOCwtNTMuMDcgMTQ2LjA1LC00My44NiIvPgo8cG9seWdvbiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgcG9pbnRzPSIxNDguODEsLTQ2LjAxIDE1Mi41OCwtMzYuMSAxNDMuNDYsLTQxLjQ5IDE0OC44MSwtNDYuMDEiLz4KPC9nPgo8L2c+Cjwvc3ZnPgo=" />
</center>
<p>Say that <code>bup get</code> is called to transfer <code>c-1</code>
from another repository. For simplicity we’ll ignore its parent commit.
It should transfer <code>c-1</code>, <code>/</code>, <code>etc</code>,
<code>fstab</code>, and <code>hosts</code>. Unfortunately, versions of
<code>bup get</code> before 0.33.5 will transfer the objects in
precisely that order, which means that if <code>bup get</code> is
interrupted at the wrong time, say just after fetching
<code>fstab</code>, it will leave an incomplete <code>etc/</code> tree
in the destination repo (because the <code>hosts</code> blob is
missing). Any future <code>bup get</code> attempts won’t fix the problem
because (as described previously) they will see <code>etc</code> in the
destination repository and assume it’s complete.</p>
<p>And of course there are many ways <code>bup get</code> might be
interrupted: full filesystem, system shutdown, network issues, or
perhaps even more likely, <code>^C</code> (SIGINT).</p>
<blockquote>
<p>Note: If you were to run <code>bup gc</code> after the aborted
transfer even the broken version of it would clean up the freshly
written pack file since the objects aren’t connected yet, but chances
are that one would just attempt to resume the transfer, resulting in it
being connected, but potentially incomplete. Also, due to the Bloom
collision bug, gc might incorrectly keep some objects.</p>
</blockquote>
</body>
</html>
